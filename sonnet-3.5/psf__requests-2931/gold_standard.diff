From fc8fa1aa265bb14d59c68eb68a179bce17953967 Mon Sep 17 00:00:00 2001
From: Cory Benfield <lukasaoz@gmail.com>
Date: Wed, 16 Dec 2015 14:56:13 +0000
Subject: [PATCH] Fix regression from #2844 regarding binary bodies.

---
 requests/models.py | 5 ++++-
 test_requests.py   | 5 +++++
 2 files changed, 9 insertions(+), 1 deletion(-)

diff --git a/requests/models.py b/requests/models.py
index 9c624d3c11..4bcbc5484a 100644
--- a/requests/models.py
+++ b/requests/models.py
@@ -81,7 +81,7 @@ def _encode_params(data):
         """
 
         if isinstance(data, (str, bytes)):
-            return to_native_string(data)
+            return data
         elif hasattr(data, 'read'):
             return data
         elif hasattr(data, '__iter__'):
@@ -385,6 +385,9 @@ def prepare_url(self, url, params):
             if isinstance(fragment, str):
                 fragment = fragment.encode('utf-8')
 
+        if isinstance(params, (str, bytes)):
+            params = to_native_string(params)
+
         enc_params = self._encode_params(params)
         if enc_params:
             if query:
diff --git a/test_requests.py b/test_requests.py
index 137edc0864..0795241867 100755
--- a/test_requests.py
+++ b/test_requests.py
@@ -157,6 +157,11 @@ def test_params_bytes_are_encoded(self):
                                    params=b'test=foo').prepare()
         assert request.url == 'http://example.com/?test=foo'
 
+    def test_binary_put(self):
+        request = requests.Request('PUT', 'http://example.com',
+                                   data=u"ööö".encode("utf-8")).prepare()
+        assert isinstance(request.body, bytes)
+
     def test_mixed_case_scheme_acceptable(self, httpbin):
         s = requests.Session()
         s.proxies = getproxies()
