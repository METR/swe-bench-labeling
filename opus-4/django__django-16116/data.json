{"instance_id": "django__django-16116", "score": "C", "diff": "diff --git a/django/core/management/commands/makemigrations.py b/django/core/management/commands/makemigrations.py\nindex 2e97d9064b..42307e652f 100644\n--- a/django/core/management/commands/makemigrations.py\n+++ b/django/core/management/commands/makemigrations.py\n@@ -248,12 +248,14 @@ class Command(BaseCommand):\n                 else:\n                     self.log(\"No changes detected\")\n         else:\n+            # If --check is enabled, exit with status 1 without writing files\n+            if check_changes:\n+                sys.exit(1)\n+            \n             if self.update:\n                 self.write_to_last_migration_files(changes)\n             else:\n                 self.write_migration_files(changes)\n-            if check_changes:\n-                sys.exit(1)\n \n     def write_to_last_migration_files(self, changes):\n         loader = MigrationLoader(connections[DEFAULT_DB_ALIAS])\n", "gold_standard_diff": "From 80d38de52bb2721a7b44fce4057bcff571afc23a Mon Sep 17 00:00:00 2001\nFrom: Jacob Walls <jacobtylerwalls@gmail.com>\nDate: Sun, 25 Sep 2022 19:53:55 -0400\nSubject: [PATCH] Fixed #34051 -- Made makemigrations --check exit before\n making migrations.\n\n---\n django/core/management/commands/makemigrations.py | 9 ++++++---\n docs/ref/django-admin.txt                         | 5 +++++\n docs/releases/4.2.txt                             | 3 +++\n tests/migrations/test_commands.py                 | 3 ++-\n 4 files changed, 16 insertions(+), 4 deletions(-)\n\ndiff --git a/django/core/management/commands/makemigrations.py b/django/core/management/commands/makemigrations.py\nindex 2e97d9064ba4..284a95409f6b 100644\n--- a/django/core/management/commands/makemigrations.py\n+++ b/django/core/management/commands/makemigrations.py\n@@ -70,7 +70,10 @@ def add_arguments(self, parser):\n             \"--check\",\n             action=\"store_true\",\n             dest=\"check_changes\",\n-            help=\"Exit with a non-zero status if model changes are missing migrations.\",\n+            help=(\n+                \"Exit with a non-zero status if model changes are missing migrations \"\n+                \"and don't actually write them.\"\n+            ),\n         )\n         parser.add_argument(\n             \"--scriptable\",\n@@ -248,12 +251,12 @@ def handle(self, *app_labels, **options):\n                 else:\n                     self.log(\"No changes detected\")\n         else:\n+            if check_changes:\n+                sys.exit(1)\n             if self.update:\n                 self.write_to_last_migration_files(changes)\n             else:\n                 self.write_migration_files(changes)\n-            if check_changes:\n-                sys.exit(1)\n \n     def write_to_last_migration_files(self, changes):\n         loader = MigrationLoader(connections[DEFAULT_DB_ALIAS])\ndiff --git a/docs/ref/django-admin.txt b/docs/ref/django-admin.txt\nindex af27e0afb5e9..aa4c4e6ff819 100644\n--- a/docs/ref/django-admin.txt\n+++ b/docs/ref/django-admin.txt\n@@ -825,6 +825,11 @@ Generate migration files without Django version and timestamp header.\n Makes ``makemigrations`` exit with a non-zero status when model changes without\n migrations are detected.\n \n+.. versionchanged:: 4.2\n+\n+    In older versions, the missing migrations were also created when using the\n+    ``--check`` option.\n+\n .. django-admin-option:: --scriptable\n \n .. versionadded:: 4.1\ndiff --git a/docs/releases/4.2.txt b/docs/releases/4.2.txt\nindex 2520d14361b7..6cfd0865f69b 100644\n--- a/docs/releases/4.2.txt\n+++ b/docs/releases/4.2.txt\n@@ -322,6 +322,9 @@ Miscellaneous\n * The ``autofocus`` HTML attribute in the admin search box is removed as it can\n   be confusing for screen readers.\n \n+* The :option:`makemigrations --check` option no longer creates missing\n+  migration files.\n+\n .. _deprecated-features-4.2:\n \n Features deprecated in 4.2\ndiff --git a/tests/migrations/test_commands.py b/tests/migrations/test_commands.py\nindex 9900c7a35dda..0117d1e4aa33 100644\n--- a/tests/migrations/test_commands.py\n+++ b/tests/migrations/test_commands.py\n@@ -2391,9 +2391,10 @@ def test_makemigrations_check(self):\n         makemigrations --check should exit with a non-zero status when\n         there are changes to an app requiring migrations.\n         \"\"\"\n-        with self.temporary_migration_module():\n+        with self.temporary_migration_module() as tmpdir:\n             with self.assertRaises(SystemExit):\n                 call_command(\"makemigrations\", \"--check\", \"migrations\", verbosity=0)\n+            self.assertFalse(os.path.exists(tmpdir))\n \n         with self.temporary_migration_module(\n             module=\"migrations.test_migrations_no_changes\"\n", "gold_standard_pr_link": "https://github.com/django/django/pull/16116"}