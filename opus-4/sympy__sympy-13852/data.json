{"instance_id": "sympy__sympy-13852", "score": "I", "diff": "diff --git a/sympy/functions/special/tests/test_zeta_functions.py b/sympy/functions/special/tests/test_zeta_functions.py\nindex 3911dadd10..85c432ae53 100644\n--- a/sympy/functions/special/tests/test_zeta_functions.py\n+++ b/sympy/functions/special/tests/test_zeta_functions.py\n@@ -128,10 +128,13 @@ def test_polylog_expansion():\n     assert polylog(s, 1) == zeta(s)\n     assert polylog(s, -1) == -dirichlet_eta(s)\n \n-    assert myexpand(polylog(1, z), -log(1 + exp_polar(-I*pi)*z))\n+    assert myexpand(polylog(1, z), -log(1 - z))\n     assert myexpand(polylog(0, z), z/(1 - z))\n     assert myexpand(polylog(-1, z), z**2/(1 - z)**2 + z/(1 - z))\n     assert myexpand(polylog(-5, z), None)\n+    \n+    # Test special value polylog(2, 1/2)\n+    assert polylog(2, S.Half) == -log(2)**2/2 + pi**2/12\n \n \n def test_lerchphi_expansion():\ndiff --git a/sympy/functions/special/zeta_functions.py b/sympy/functions/special/zeta_functions.py\nindex b8e2b66195..1181d10232 100644\n--- a/sympy/functions/special/zeta_functions.py\n+++ b/sympy/functions/special/zeta_functions.py\n@@ -253,7 +253,7 @@ class polylog(Function):\n     >>> from sympy import expand_func\n     >>> from sympy.abc import z\n     >>> expand_func(polylog(1, z))\n-    -log(z*exp_polar(-I*pi) + 1)\n+    -log(1 - z)\n     >>> expand_func(polylog(0, z))\n     z/(-z + 1)\n \n@@ -277,6 +277,10 @@ def eval(cls, s, z):\n             return -dirichlet_eta(s)\n         elif z == 0:\n             return 0\n+        # Special case: polylog(2, 1/2) = -log(2)**2/2 + pi**2/12\n+        elif s == 2 and z == S.Half:\n+            from sympy import log\n+            return -log(2)**2/2 + pi**2/12\n \n     def fdiff(self, argindex=1):\n         s, z = self.args\n@@ -288,10 +292,10 @@ def _eval_rewrite_as_lerchphi(self, s, z):\n         return z*lerchphi(z, s, 1)\n \n     def _eval_expand_func(self, **hints):\n-        from sympy import log, expand_mul, Dummy, exp_polar, I\n+        from sympy import log, expand_mul, Dummy\n         s, z = self.args\n         if s == 1:\n-            return -log(1 + exp_polar(-I*pi)*z)\n+            return -log(1 - z)\n         if s.is_Integer and s <= 0:\n             u = Dummy('u')\n             start = u/(1 - u)\ndiff --git a/test_final_verification.py b/test_final_verification.py\nnew file mode 100644\nindex 0000000000..4881e833a2\n--- /dev/null\n+++ b/test_final_verification.py\n@@ -0,0 +1,45 @@\n+from sympy import *\n+from sympy.abc import z, s\n+\n+print(\"=== Testing polylog(2, 1/2) evaluation ===\")\n+result = polylog(2, Rational(1,2))\n+expected = -log(2)**2/2 + pi**2/12\n+print(f\"polylog(2, 1/2) = {result}\")\n+print(f\"Expected: {expected}\")\n+print(f\"Are they equal? {result == expected}\")\n+\n+print(\"\\n=== Testing polylog(1, z) expansion ===\")\n+expanded = expand_func(polylog(1, z))\n+print(f\"expand_func(polylog(1, z)) = {expanded}\")\n+print(f\"Expected: -log(1 - z)\")\n+print(f\"Are they equal? {expanded == -log(1 - z)}\")\n+\n+print(\"\\n=== Testing derivative consistency ===\")\n+# According to the issue, polylog(1, z) and -log(1-z) should be the same function\n+# so their derivatives should be equal\n+deriv1 = diff(polylog(1, z), z)\n+deriv2 = diff(-log(1 - z), z)\n+print(f\"diff(polylog(1, z), z) = {deriv1}\")\n+print(f\"diff(-log(1 - z), z) = {deriv2}\")\n+\n+# After expansion, the derivative should still be consistent\n+deriv3 = diff(expand_func(polylog(1, z)), z)\n+print(f\"diff(expand_func(polylog(1, z)), z) = {deriv3}\")\n+print(f\"Simplified difference: {simplify(deriv3 - deriv2)}\")\n+\n+print(\"\\n=== Testing numerical values ===\")\n+# Test at z = 0.5\n+z_val = 0.5\n+poly_val = polylog(1, z_val).evalf()\n+log_val = (-log(1 - z_val)).evalf()\n+print(f\"polylog(1, 0.5).evalf() = {poly_val}\")\n+print(f\"(-log(1 - 0.5)).evalf() = {log_val}\")\n+print(f\"Difference: {abs(poly_val - log_val)}\")\n+\n+print(\"\\n=== Testing expand_func no longer uses exp_polar ===\")\n+expanded_str = str(expand_func(polylog(1, z)))\n+has_exp_polar = \"exp_polar\" in expanded_str\n+print(f\"expand_func(polylog(1, z)) = {expanded_str}\")\n+print(f\"Contains exp_polar? {has_exp_polar}\")\n+\n+print(\"\\n=== All tests completed ===\")\ndiff --git a/test_issue_scenarios.py b/test_issue_scenarios.py\nnew file mode 100644\nindex 0000000000..0806837103\n--- /dev/null\n+++ b/test_issue_scenarios.py\n@@ -0,0 +1,36 @@\n+from sympy import *\n+from sympy.functions.special.zeta_functions import polylog\n+\n+print(\"Testing the exact scenarios from the issue:\")\n+print()\n+\n+# Test 1: polylog(2, Rational(1,2))\n+print(\"In [1]: polylog(2, Rational(1,2))\")\n+result = polylog(2, Rational(1,2))\n+print(f\"Out[1]: {result}\")\n+print()\n+\n+# Test 2: polylog(2, Rational(1,2)).expand(func=True)\n+print(\"In [2]: polylog(2, Rational(1,2)).expand(func=True)\")\n+result2 = polylog(2, Rational(1,2)).expand(func=True)\n+print(f\"Out[2]: {result2}\")\n+print()\n+\n+print(\"The answer should be -log(2)**2/2 + pi**2/12\")\n+expected = -log(2)**2/2 + pi**2/12\n+print(f\"Expected: {expected}\")\n+print()\n+\n+# Test expand_func on polylog(1, z)\n+print(\"Testing expand_func(polylog(1, z)):\")\n+from sympy.abc import z\n+result3 = expand_func(polylog(1, z))\n+print(f\"Result: {result3}\")\n+print(\"No longer contains exp_polar(-I*pi)!\")\n+print()\n+\n+# Verify derivative consistency\n+print(\"Verifying derivative consistency:\")\n+print(f\"expand_func(diff(polylog(1, z) + log(1 - z), z)) = {expand_func(diff(polylog(1, z) + log(1 - z), z))}\")\n+print(\"Should simplify to 0\")\n+print(f\"simplify(...) = {simplify(diff(polylog(1, z) + log(1 - z), z))}\")\ndiff --git a/test_polylog_issue.py b/test_polylog_issue.py\nnew file mode 100644\nindex 0000000000..0513b89dbc\n--- /dev/null\n+++ b/test_polylog_issue.py\n@@ -0,0 +1,26 @@\n+from sympy import *\n+from sympy.abc import z, s\n+\n+# Test current behavior\n+print(\"Testing polylog(2, 1/2):\")\n+print(f\"polylog(2, Rational(1,2)) = {polylog(2, Rational(1,2))}\")\n+print(f\"expand_func(polylog(2, Rational(1,2))) = {expand_func(polylog(2, Rational(1,2)))}\")\n+\n+# The expected value\n+expected = -log(2)**2/2 + pi**2/12\n+print(f\"Expected value: {expected}\")\n+print(f\"Expected value (numerical): {expected.evalf()}\")\n+print(f\"polylog(2, 1/2) numerical: {polylog(2, Rational(1,2)).evalf()}\")\n+\n+print(\"\\nTesting polylog(1, z) expansion:\")\n+print(f\"expand_func(polylog(1, z)) = {expand_func(polylog(1, z))}\")\n+print(f\"Expected: -log(1 - z)\")\n+\n+# Check derivative consistency\n+print(\"\\nDerivative check:\")\n+print(f\"diff(polylog(1, z), z) = {diff(polylog(1, z), z)}\")\n+print(f\"diff(expand_func(polylog(1, z)), z) = {diff(expand_func(polylog(1, z)), z)}\")\n+print(f\"diff(-log(1-z), z) = {diff(-log(1-z), z)}\")\n+\n+# Verify they should be the same\n+print(f\"\\nSimplify diff(polylog(1, z) + log(1 - z), z) = {simplify(diff(polylog(1, z) + log(1 - z), z))}\")\n", "gold_standard_diff": "diff --git a/sympy/functions/special/tests/test_zeta_functions.py b/sympy/functions/special/tests/test_zeta_functions.py\nindex 3911dadd103b..486047694445 100644\n--- a/sympy/functions/special/tests/test_zeta_functions.py\n+++ b/sympy/functions/special/tests/test_zeta_functions.py\n@@ -1,6 +1,6 @@\n from sympy import (Symbol, zeta, nan, Rational, Float, pi, dirichlet_eta, log,\n                    zoo, expand_func, polylog, lerchphi, S, exp, sqrt, I,\n-                   exp_polar, polar_lift, O, stieltjes)\n+                   exp_polar, polar_lift, O, stieltjes, Abs)\n from sympy.utilities.randtest import (test_derivative_numerically as td,\n                       random_complex_number as randcplx, verify_numerically as tn)\n \n@@ -128,12 +128,25 @@ def test_polylog_expansion():\n     assert polylog(s, 1) == zeta(s)\n     assert polylog(s, -1) == -dirichlet_eta(s)\n \n-    assert myexpand(polylog(1, z), -log(1 + exp_polar(-I*pi)*z))\n+    assert myexpand(polylog(1, z), -log(1 - z))\n     assert myexpand(polylog(0, z), z/(1 - z))\n-    assert myexpand(polylog(-1, z), z**2/(1 - z)**2 + z/(1 - z))\n+    assert myexpand(polylog(-1, z), z/(1 - z)**2)\n+    assert ((1-z)**3 * expand_func(polylog(-2, z))).simplify() == z*(1 + z)\n     assert myexpand(polylog(-5, z), None)\n \n \n+def test_polylog_values():\n+    import random\n+    assert polylog(2, 2) == pi**2/4 - I*pi*log(2)\n+    assert polylog(2, S.Half) == pi**2/12 - log(2)**2/2\n+    for z in [S.Half, 2, (sqrt(5)-1)/2, -(sqrt(5)-1)/2, -(sqrt(5)+1)/2, (3-sqrt(5))/2]:\n+        assert Abs(polylog(2, z).evalf() - polylog(2, z, evaluate=False).evalf()) < 1e-15\n+    for s in [-1, 0, 1]:\n+        for _ in range(10):\n+            z = random.uniform(-5, 5) + I*random.uniform(-5, 5)\n+            assert Abs(polylog(s, z).evalf() - polylog(s, z, evaluate=False).evalf()) < 1e-15\n+\n+\n def test_lerchphi_expansion():\n     assert myexpand(lerchphi(1, s, a), zeta(s, a))\n     assert myexpand(lerchphi(z, s, 1), polylog(s, z)/z)\ndiff --git a/sympy/functions/special/zeta_functions.py b/sympy/functions/special/zeta_functions.py\nindex b8e2b66195e0..8e9737aaf647 100644\n--- a/sympy/functions/special/zeta_functions.py\n+++ b/sympy/functions/special/zeta_functions.py\n@@ -1,12 +1,12 @@\n \"\"\" Riemann zeta and related function. \"\"\"\n from __future__ import print_function, division\n \n-from sympy.core import Function, S, sympify, pi\n+from sympy.core import Function, S, sympify, pi, I\n from sympy.core.function import ArgumentIndexError\n from sympy.core.compatibility import range\n from sympy.functions.combinatorial.numbers import bernoulli, factorial, harmonic\n from sympy.functions.elementary.exponential import log\n-\n+from sympy.functions.elementary.miscellaneous import sqrt\n \n ###############################################################################\n ###################### LERCH TRANSCENDENT #####################################\n@@ -253,7 +253,7 @@ class polylog(Function):\n     >>> from sympy import expand_func\n     >>> from sympy.abc import z\n     >>> expand_func(polylog(1, z))\n-    -log(z*exp_polar(-I*pi) + 1)\n+    -log(-z + 1)\n     >>> expand_func(polylog(0, z))\n     z/(-z + 1)\n \n@@ -276,7 +276,27 @@ def eval(cls, s, z):\n         elif z == -1:\n             return -dirichlet_eta(s)\n         elif z == 0:\n-            return 0\n+            return S.Zero\n+        elif s == 2:\n+            if z == S.Half:\n+                return pi**2/12 - log(2)**2/2\n+            elif z == 2:\n+                return pi**2/4 - I*pi*log(2)\n+            elif z == -(sqrt(5) - 1)/2:\n+                return -pi**2/15 + log((sqrt(5)-1)/2)**2/2\n+            elif z == -(sqrt(5) + 1)/2:\n+                return -pi**2/10 - log((sqrt(5)+1)/2)**2\n+            elif z == (3 - sqrt(5))/2:\n+                return pi**2/15 - log((sqrt(5)-1)/2)**2\n+            elif z == (sqrt(5) - 1)/2:\n+                return pi**2/10 - log((sqrt(5)-1)/2)**2\n+        # For s = 0 or -1 use explicit formulas to evaluate, but\n+        # automatically expanding polylog(1, z) to -log(1-z) seems undesirable\n+        # for summation methods based on hypergeometric functions\n+        elif s == 0:\n+            return z/(1 - z)\n+        elif s == -1:\n+            return z/(1 - z)**2\n \n     def fdiff(self, argindex=1):\n         s, z = self.args\n@@ -291,7 +311,7 @@ def _eval_expand_func(self, **hints):\n         from sympy import log, expand_mul, Dummy, exp_polar, I\n         s, z = self.args\n         if s == 1:\n-            return -log(1 + exp_polar(-I*pi)*z)\n+            return -log(1 - z)\n         if s.is_Integer and s <= 0:\n             u = Dummy('u')\n             start = u/(1 - u)\n", "gold_standard_pr_link": "https://github.com/sympy/sympy/pull/13852"}