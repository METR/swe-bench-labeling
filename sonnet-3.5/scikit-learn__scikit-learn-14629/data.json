{"instance_id": "scikit-learn__scikit-learn-14629", "score": "I", "diff": "diff --git a/sklearn/model_selection/_validation.py b/sklearn/model_selection/_validation.py\nindex 95669a212..9397dda57 100644\n--- a/sklearn/model_selection/_validation.py\n+++ b/sklearn/model_selection/_validation.py\n@@ -853,17 +853,29 @@ def _fit_and_predict(estimator, X, y, train, test, verbose, fit_params,\n         estimator.fit(X_train, y_train, **fit_params)\n     func = getattr(estimator, method)\n     predictions = func(X_test)\n+        # Handle MultiOutputClassifier separately, as it doesn't have a classes_ attribute\n+        # Instead, we need to access the classes_ attribute of individual estimators\n     if method in ['decision_function', 'predict_proba', 'predict_log_proba']:\n         if isinstance(predictions, list):\n-            predictions = [_enforce_prediction_order(\n-                estimator.classes_[i_label], predictions[i_label],\n-                n_classes=len(set(y[:, i_label])), method=method)\n-                for i_label in range(len(predictions))]\n+            if hasattr(estimator, 'estimators_'):  # Check if it's a MultiOutputClassifier\n+                predictions = [_enforce_prediction_order(\n+                    estimator.estimators_[i_label].classes_, predictions[i_label],\n+                    n_classes=len(set(y[:, i_label])), method=method)\n+                    for i_label in range(len(predictions))]\n+            else:\n+                predictions = [_enforce_prediction_order(\n+                    estimator.classes_[i_label], predictions[i_label],\n+                    n_classes=len(set(y[:, i_label])), method=method)\n+                    for i_label in range(len(predictions))]\n         else:\n             # A 2D y array should be a binary label indicator matrix\n             n_classes = len(set(y)) if y.ndim == 1 else y.shape[1]\n-            predictions = _enforce_prediction_order(\n-                estimator.classes_, predictions, n_classes, method)\n+            if hasattr(estimator, 'estimators_'):  # Check if it's a MultiOutputClassifier\n+                predictions = _enforce_prediction_order(\n+                    estimator.estimators_[0].classes_, predictions, n_classes, method)\n+            else:\n+                predictions = _enforce_prediction_order(\n+                    estimator.classes_, predictions, n_classes, method)\n     return predictions, test\n \n \n", "gold_standard_diff": "From 93655c07d9fa832f493d87e0d0bac6633b7b538c Mon Sep 17 00:00:00 2001\nFrom: agamemnonc <agamemnon.krasoulis@gmail.com>\nDate: Mon, 12 Aug 2019 10:06:14 +0100\nSubject: [PATCH 1/9] fix classes_ in MultiOutpucClassifier\n\n---\n sklearn/multioutput.py | 25 ++++++++++++++++++++++++-\n 1 file changed, 24 insertions(+), 1 deletion(-)\n\ndiff --git a/sklearn/multioutput.py b/sklearn/multioutput.py\nindex 4411919c1821f..e6ba353c1464c 100644\n--- a/sklearn/multioutput.py\n+++ b/sklearn/multioutput.py\n@@ -325,6 +325,28 @@ class MultiOutputClassifier(MultiOutputEstimator, ClassifierMixin):\n     def __init__(self, estimator, n_jobs=None):\n         super().__init__(estimator, n_jobs)\n \n+    def fit(self, X, Y, sample_weight=None):\n+        \"\"\"Fit the model to data matrix X and targets Y.\n+\n+        Parameters\n+        ----------\n+        X : {array-like, sparse matrix}, shape (n_samples, n_features)\n+            The input data.\n+        Y : array-like, shape (n_samples, n_classes)\n+            The target values.\n+        sample_weight : array-like, shape = (n_samples) or None\n+            Sample weights. If None, then samples are equally weighted.\n+            Only supported if the underlying classifier supports sample\n+            weights.\n+\n+        Returns\n+        -------\n+        self : object\n+        \"\"\"\n+        super().fit(X, Y, sample_weight)\n+        self.classes_ = [estimator.classes_ for estimator in self.estimators_]\n+        return self\n+\n     def predict_proba(self, X):\n         \"\"\"Probability estimates.\n         Returns prediction probabilities for each class of each output.\n@@ -420,7 +442,7 @@ def fit(self, X, Y):\n             if self.order_ == 'random':\n                 self.order_ = random_state.permutation(Y.shape[1])\n         elif sorted(self.order_) != list(range(Y.shape[1])):\n-                raise ValueError(\"invalid order\")\n+            raise ValueError(\"invalid order\")\n \n         self.estimators_ = [clone(self.base_estimator)\n                             for _ in range(Y.shape[1])]\n@@ -718,6 +740,7 @@ class RegressorChain(_BaseChain, RegressorMixin, MetaEstimatorMixin):\n         chaining.\n \n     \"\"\"\n+\n     def fit(self, X, Y):\n         \"\"\"Fit the model to data matrix X and targets Y.\n \n\nFrom e915de225d2e4e2079c74ba4d6f8380439bb44b1 Mon Sep 17 00:00:00 2001\nFrom: agamemnonc <agamemnon.krasoulis@gmail.com>\nDate: Mon, 12 Aug 2019 10:30:08 +0100\nSubject: [PATCH 2/9] update whats_new\n\n---\n doc/whats_new/v0.22.rst | 6 ++++++\n 1 file changed, 6 insertions(+)\n\ndiff --git a/doc/whats_new/v0.22.rst b/doc/whats_new/v0.22.rst\nindex 188e52a27d925..eb08576af3c47 100644\n--- a/doc/whats_new/v0.22.rst\n+++ b/doc/whats_new/v0.22.rst\n@@ -235,6 +235,12 @@ Changelog\n - |Enhancement| :class:`model_selection.RandomizedSearchCV` now accepts lists\n   of parameter distributions. :pr:`14549` by `Andreas M\u00fcller`_.\n \n+:mod:`sklearn.multioutput`\n+..........................\n+\n+- |Fix| :class:`MultiOutputClassifier` now has attribute `classes_`.\n+  :issue:`14615` by :user:`Agamemnon Krasoulis <agamemnonc>`.\n+\n :mod:`sklearn.pipeline`\n .......................\n \n\nFrom 63572cff4c0b8bf8117084d7a870523ead079cd8 Mon Sep 17 00:00:00 2001\nFrom: agamemnonc <agamemnon.krasoulis@gmail.com>\nDate: Mon, 12 Aug 2019 14:45:15 +0100\nSubject: [PATCH 3/9] extend tests to check classes_ attribute\n\n---\n sklearn/tests/test_multioutput.py | 8 ++++++++\n 1 file changed, 8 insertions(+)\n\ndiff --git a/sklearn/tests/test_multioutput.py b/sklearn/tests/test_multioutput.py\nindex e70048a7fa257..910773e7e0ac4 100644\n--- a/sklearn/tests/test_multioutput.py\n+++ b/sklearn/tests/test_multioutput.py\n@@ -275,6 +275,10 @@ def test_multi_output_classification():\n         assert_array_equal(list(forest_.predict_proba(X)),\n                            list(predict_proba[i]))\n \n+    # test classes_ attribute\n+    [assert_array_equal(classes_true, classes_estim) for (classes_true,\n+        classes_estim) in zip(classes, multi_target_forest.classes_)]\n+\n \n def test_multiclass_multioutput_estimator():\n     # test to check meta of meta estimators\n@@ -294,6 +298,10 @@ def test_multiclass_multioutput_estimator():\n         assert (list(multi_class_svc_.predict(X)) ==\n                      list(predictions[:, i]))\n \n+    # test classes_ attribute\n+    [assert_array_equal(classes_true, classes_estim) for (classes_true,\n+        classes_estim) in zip(classes, multi_target_svc.classes_)]\n+\n \n def test_multiclass_multioutput_estimator_predict_proba():\n     seed = 542\n\nFrom 373d22e1dc3b95a63ff8420c6a74db6070b77f08 Mon Sep 17 00:00:00 2001\nFrom: agamemnonc <agamemnon.krasoulis@gmail.com>\nDate: Mon, 12 Aug 2019 14:49:34 +0100\nSubject: [PATCH 4/9] update whatsnew entry with PR number\n\n---\n doc/whats_new/v0.22.rst | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/doc/whats_new/v0.22.rst b/doc/whats_new/v0.22.rst\nindex eb08576af3c47..c8f13bc942fb2 100644\n--- a/doc/whats_new/v0.22.rst\n+++ b/doc/whats_new/v0.22.rst\n@@ -239,7 +239,7 @@ Changelog\n ..........................\n \n - |Fix| :class:`MultiOutputClassifier` now has attribute `classes_`.\n-  :issue:`14615` by :user:`Agamemnon Krasoulis <agamemnonc>`.\n+  :pr:`14629` by :user:`Agamemnon Krasoulis <agamemnonc>`.\n \n :mod:`sklearn.pipeline`\n .......................\n\nFrom 55a11897c4e5548b4d42bac5e91874d13af1990b Mon Sep 17 00:00:00 2001\nFrom: agamemnonc <agamemnon.krasoulis@gmail.com>\nDate: Mon, 12 Aug 2019 15:46:46 +0100\nSubject: [PATCH 5/9] pep8 fix\n\n---\n sklearn/tests/test_multioutput.py | 8 ++++----\n 1 file changed, 4 insertions(+), 4 deletions(-)\n\ndiff --git a/sklearn/tests/test_multioutput.py b/sklearn/tests/test_multioutput.py\nindex 910773e7e0ac4..32e0f8800e9c5 100644\n--- a/sklearn/tests/test_multioutput.py\n+++ b/sklearn/tests/test_multioutput.py\n@@ -276,8 +276,8 @@ def test_multi_output_classification():\n                            list(predict_proba[i]))\n \n     # test classes_ attribute\n-    [assert_array_equal(classes_true, classes_estim) for (classes_true,\n-        classes_estim) in zip(classes, multi_target_forest.classes_)]\n+    [assert_array_equal(classes_true, classes_est) for\n+     (classes_true, classes_est) in zip(classes, multi_target_forest.classes_)]\n \n \n def test_multiclass_multioutput_estimator():\n@@ -299,8 +299,8 @@ def test_multiclass_multioutput_estimator():\n                      list(predictions[:, i]))\n \n     # test classes_ attribute\n-    [assert_array_equal(classes_true, classes_estim) for (classes_true,\n-        classes_estim) in zip(classes, multi_target_svc.classes_)]\n+    [assert_array_equal(classes_true, classes_est) for\n+     (classes_true, classes_est) in zip(classes, multi_target_svc.classes_)]\n \n \n def test_multiclass_multioutput_estimator_predict_proba():\n\nFrom c6d23498bc943253a7cebc9f01ba964b6f8e6f74 Mon Sep 17 00:00:00 2001\nFrom: agamemnonc <agamemnon.krasoulis@gmail.com>\nDate: Tue, 13 Aug 2019 10:15:23 +0100\nSubject: [PATCH 6/9] update test to include other multioutput estimators\n\n---\n sklearn/tests/test_multioutput.py | 26 ++++++++++++++++++--------\n 1 file changed, 18 insertions(+), 8 deletions(-)\n\ndiff --git a/sklearn/tests/test_multioutput.py b/sklearn/tests/test_multioutput.py\nindex 32e0f8800e9c5..ed4d9b4682585 100644\n--- a/sklearn/tests/test_multioutput.py\n+++ b/sklearn/tests/test_multioutput.py\n@@ -275,10 +275,6 @@ def test_multi_output_classification():\n         assert_array_equal(list(forest_.predict_proba(X)),\n                            list(predict_proba[i]))\n \n-    # test classes_ attribute\n-    [assert_array_equal(classes_true, classes_est) for\n-     (classes_true, classes_est) in zip(classes, multi_target_forest.classes_)]\n-\n \n def test_multiclass_multioutput_estimator():\n     # test to check meta of meta estimators\n@@ -298,10 +294,6 @@ def test_multiclass_multioutput_estimator():\n         assert (list(multi_class_svc_.predict(X)) ==\n                      list(predictions[:, i]))\n \n-    # test classes_ attribute\n-    [assert_array_equal(classes_true, classes_est) for\n-     (classes_true, classes_est) in zip(classes, multi_target_svc.classes_)]\n-\n \n def test_multiclass_multioutput_estimator_predict_proba():\n     seed = 542\n@@ -535,3 +527,21 @@ def test_base_chain_crossval_fit_and_predict():\n             assert jaccard_score(Y, Y_pred_cv, average='samples') > .4\n         else:\n             assert mean_squared_error(Y, Y_pred_cv) < .25\n+\n+\n+def test_multi_output_classes_():\n+    # Tests classes_ attribute of multioutput classifiers\n+    # RandomForestClassifier supports multioutput out-of-the-box\n+    forest = RandomForestClassifier(n_estimators=10, random_state=1)\n+    multi_output_forest = MultiOutputClassifier(forest)\n+    cc_forest = ClassifierChain(forest)\n+\n+    forest.fit(X, y)\n+    multi_output_forest.fit(X, y)\n+    cc_forest.fit(X, y)\n+\n+    for estimator in [forest, multi_output_forest, cc_forest]:\n+        assert isinstance(estimator.classes_, list)\n+        assert len(estimator.classes_) == n_outputs\n+        [assert_array_equal(classes_true, classes_est) for\n+         (classes_true, classes_est) in zip(classes, estimator.classes_)]\n\nFrom ec7845f7f703a1e595d05349560a89dc5f7b650f Mon Sep 17 00:00:00 2001\nFrom: agamemnonc <agamemnon.krasoulis@gmail.com>\nDate: Tue, 13 Aug 2019 17:56:53 +0100\nSubject: [PATCH 7/9] nitpicks\n\n---\n sklearn/multioutput.py            |  7 +++----\n sklearn/tests/test_multioutput.py | 31 +++++++++++++++----------------\n 2 files changed, 18 insertions(+), 20 deletions(-)\n\ndiff --git a/sklearn/multioutput.py b/sklearn/multioutput.py\nindex e6ba353c1464c..4504b8d6b754d 100644\n--- a/sklearn/multioutput.py\n+++ b/sklearn/multioutput.py\n@@ -330,11 +330,11 @@ def fit(self, X, Y, sample_weight=None):\n \n         Parameters\n         ----------\n-        X : {array-like, sparse matrix}, shape (n_samples, n_features)\n+        X : {array-like, sparse matrix} of shape (n_samples, n_features)\n             The input data.\n-        Y : array-like, shape (n_samples, n_classes)\n+        Y : array-like of shape (n_samples, n_classes)\n             The target values.\n-        sample_weight : array-like, shape = (n_samples) or None\n+        sample_weight : array-like of shape (n_samples,) or None\n             Sample weights. If None, then samples are equally weighted.\n             Only supported if the underlying classifier supports sample\n             weights.\n@@ -740,7 +740,6 @@ class RegressorChain(_BaseChain, RegressorMixin, MetaEstimatorMixin):\n         chaining.\n \n     \"\"\"\n-\n     def fit(self, X, Y):\n         \"\"\"Fit the model to data matrix X and targets Y.\n \ndiff --git a/sklearn/tests/test_multioutput.py b/sklearn/tests/test_multioutput.py\nindex ed4d9b4682585..8275161434592 100644\n--- a/sklearn/tests/test_multioutput.py\n+++ b/sklearn/tests/test_multioutput.py\n@@ -529,19 +529,18 @@ def test_base_chain_crossval_fit_and_predict():\n             assert mean_squared_error(Y, Y_pred_cv) < .25\n \n \n-def test_multi_output_classes_():\n-    # Tests classes_ attribute of multioutput classifiers\n-    # RandomForestClassifier supports multioutput out-of-the-box\n-    forest = RandomForestClassifier(n_estimators=10, random_state=1)\n-    multi_output_forest = MultiOutputClassifier(forest)\n-    cc_forest = ClassifierChain(forest)\n-\n-    forest.fit(X, y)\n-    multi_output_forest.fit(X, y)\n-    cc_forest.fit(X, y)\n-\n-    for estimator in [forest, multi_output_forest, cc_forest]:\n-        assert isinstance(estimator.classes_, list)\n-        assert len(estimator.classes_) == n_outputs\n-        [assert_array_equal(classes_true, classes_est) for\n-         (classes_true, classes_est) in zip(classes, estimator.classes_)]\n+# Tests classes_ attribute of multioutput classifiers\n+# RandomForestClassifier supports multioutput out-of-the-box\n+@pytest.mark.parametrize(\n+    'estimator',\n+    [RandomForestClassifier(n_estimators=2),\n+     MultiOutputClassifier(RandomForestClassifier(n_estimators=2)),\n+     ClassifierChain(RandomForestClassifier(n_estimators=2))]\n+)\n+def test_multi_output_classes_(estimator):\n+    estimator.fit(X, y)\n+    assert isinstance(estimator.classes_, list)\n+    assert len(estimator.classes_) == n_outputs\n+    for estimator_classes, expected_classes in zip(classes,\n+                                                   estimator.classes_):\n+        assert_array_equal(estimator_classes, expected_classes)\n\nFrom b30cb38b413d11e52f2fb35b4aa9a80cd60af5ec Mon Sep 17 00:00:00 2001\nFrom: agamemnonc <agamemnon.krasoulis@gmail.com>\nDate: Wed, 14 Aug 2019 07:25:50 +0100\nSubject: [PATCH 8/9] whats_new nitpick\n\n---\n doc/whats_new/v0.22.rst | 4 ++--\n 1 file changed, 2 insertions(+), 2 deletions(-)\n\ndiff --git a/doc/whats_new/v0.22.rst b/doc/whats_new/v0.22.rst\nindex 5a91ff0d567c6..8476b6bd51228 100644\n--- a/doc/whats_new/v0.22.rst\n+++ b/doc/whats_new/v0.22.rst\n@@ -254,8 +254,8 @@ Changelog\n :mod:`sklearn.multioutput`\n ..........................\n \n-- |Fix| :class:`MultiOutputClassifier` now has attribute `classes_`.\n-  :pr:`14629` by :user:`Agamemnon Krasoulis <agamemnonc>`.\n+- |Fix| :class:`multioutput.MultiOutputClassifier` now has attribute\n+  ``classes_``. :pr:`14629` by :user:`Agamemnon Krasoulis <agamemnonc>`.\n \n :mod:`sklearn.pipeline`\n .......................\n\nFrom 3167ba180a400a147745eb7673f30d67271d7a23 Mon Sep 17 00:00:00 2001\nFrom: agamemnonc <agamemnon.krasoulis@gmail.com>\nDate: Wed, 14 Aug 2019 07:26:15 +0100\nSubject: [PATCH 9/9] test nitpick\n\n---\n sklearn/tests/test_multioutput.py | 4 ++--\n 1 file changed, 2 insertions(+), 2 deletions(-)\n\ndiff --git a/sklearn/tests/test_multioutput.py b/sklearn/tests/test_multioutput.py\nindex 8275161434592..e1d2433197b1c 100644\n--- a/sklearn/tests/test_multioutput.py\n+++ b/sklearn/tests/test_multioutput.py\n@@ -529,8 +529,6 @@ def test_base_chain_crossval_fit_and_predict():\n             assert mean_squared_error(Y, Y_pred_cv) < .25\n \n \n-# Tests classes_ attribute of multioutput classifiers\n-# RandomForestClassifier supports multioutput out-of-the-box\n @pytest.mark.parametrize(\n     'estimator',\n     [RandomForestClassifier(n_estimators=2),\n@@ -538,6 +536,8 @@ def test_base_chain_crossval_fit_and_predict():\n      ClassifierChain(RandomForestClassifier(n_estimators=2))]\n )\n def test_multi_output_classes_(estimator):\n+    # Tests classes_ attribute of multioutput classifiers\n+    # RandomForestClassifier supports multioutput out-of-the-box\n     estimator.fit(X, y)\n     assert isinstance(estimator.classes_, list)\n     assert len(estimator.classes_) == n_outputs\n", "gold_standard_pr_link": "https://github.com/scikit-learn/scikit-learn/pull/14629"}