From fbc0e01d76bace4c8f6101e6d837755d9b4a2bc5 Mon Sep 17 00:00:00 2001
From: Anderson Banihirwe <axbanihirwe@ualr.edu>
Date: Mon, 14 Dec 2020 17:22:09 -0700
Subject: [PATCH 1/4] Fixes #2840

---
 xarray/core/dataarray.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/xarray/core/dataarray.py b/xarray/core/dataarray.py
index 32b24ef1f39..6316afd57f5 100644
--- a/xarray/core/dataarray.py
+++ b/xarray/core/dataarray.py
@@ -196,7 +196,7 @@ def __getitem__(self, key) -> "DataArray":
             # expand the indexer so we can handle Ellipsis
             labels = indexing.expanded_indexer(key, self.data_array.ndim)
             key = dict(zip(self.data_array.dims, labels))
-        return self.data_array.sel(**key)
+        return self.data_array.sel(key)
 
     def __setitem__(self, key, value) -> None:
         if not utils.is_dict_like(key):

From 406c1c98d7db3cda129bbdd4ceeaec0fcb1256e6 Mon Sep 17 00:00:00 2001
From: Anderson Banihirwe <axbanihirwe@ualr.edu>
Date: Tue, 15 Dec 2020 06:47:15 -0700
Subject: [PATCH 2/4] Add test

---
 xarray/tests/test_dataarray.py | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/xarray/tests/test_dataarray.py b/xarray/tests/test_dataarray.py
index a8c62a2ce15..d114467836e 100644
--- a/xarray/tests/test_dataarray.py
+++ b/xarray/tests/test_dataarray.py
@@ -1170,6 +1170,14 @@ def test_loc_single_boolean(self):
         assert data.loc[True] == 0
         assert data.loc[False] == 1
 
+    def test_loc_dim_name_collision_with_sel_params(self):
+        da = xr.DataArray(
+            [[0, 0], [1, 1]],
+            dims=["dim1", "method"],
+            coords={"dim1": ["x", "y"], "method": ["a", "b"]},
+        )
+        assert da.loc[dict(dim1=["x", "y"], method=["a"])] == [[0], [1]]
+
     def test_selection_multiindex(self):
         mindex = pd.MultiIndex.from_product(
             [["a", "b"], [1, 2], [-1, -2]], names=("one", "two", "three")

From 72fbedd07df54c8b8487d2233855cec5e6240c08 Mon Sep 17 00:00:00 2001
From: Anderson Banihirwe <axbanihirwe@ualr.edu>
Date: Tue, 15 Dec 2020 06:57:53 -0700
Subject: [PATCH 3/4] Fix test

---
 xarray/tests/test_dataarray.py | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/xarray/tests/test_dataarray.py b/xarray/tests/test_dataarray.py
index d114467836e..f9a0af452e4 100644
--- a/xarray/tests/test_dataarray.py
+++ b/xarray/tests/test_dataarray.py
@@ -1176,7 +1176,9 @@ def test_loc_dim_name_collision_with_sel_params(self):
             dims=["dim1", "method"],
             coords={"dim1": ["x", "y"], "method": ["a", "b"]},
         )
-        assert da.loc[dict(dim1=["x", "y"], method=["a"])] == [[0], [1]]
+        np.testing.assert_array_equal(
+            da.loc[dict(dim1=["x", "y"], method=["a"])], [[0], [1]]
+        )
 
     def test_selection_multiindex(self):
         mindex = pd.MultiIndex.from_product(

From 26499a05f814f0ed5c29b6fac35cdbf74eefaddf Mon Sep 17 00:00:00 2001
From: Anderson Banihirwe <axbanihirwe@ualr.edu>
Date: Tue, 15 Dec 2020 06:59:53 -0700
Subject: [PATCH 4/4] Update whats-new

---
 doc/whats-new.rst | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/doc/whats-new.rst b/doc/whats-new.rst
index 94a38757851..c028b1e2a29 100644
--- a/doc/whats-new.rst
+++ b/doc/whats-new.rst
@@ -32,6 +32,8 @@ Bug fixes
 ~~~~~~~~~
 
 - :py:func:`merge` with ``combine_attrs='override'`` makes a copy of the attrs (:issue:`4627`).
+- Remove dictionary unpacking when using ``.loc`` to avoid collision with ``.sel`` parameters (:pull:`4695`).
+  By `Anderson Banihirwe <https://github.com/andersy005>`_
 
 Documentation
 ~~~~~~~~~~~~~
