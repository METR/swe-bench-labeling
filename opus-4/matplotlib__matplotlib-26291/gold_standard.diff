From dae0cc2c28eb6f52ced1056bf9fb7eb64e4b8a5c Mon Sep 17 00:00:00 2001
From: Kyle Sunden <git@ksunden.space>
Date: Tue, 11 Jul 2023 23:26:18 -0500
Subject: [PATCH] Get correct renderer for axes_grid1 inset axes with
 bbox_inches=tight

---
 lib/mpl_toolkits/axes_grid1/inset_locator.py         |  2 ++
 lib/mpl_toolkits/axes_grid1/tests/test_axes_grid1.py | 10 ++++++++++
 2 files changed, 12 insertions(+)

diff --git a/lib/mpl_toolkits/axes_grid1/inset_locator.py b/lib/mpl_toolkits/axes_grid1/inset_locator.py
index 9d350510742f..46284c6802f1 100644
--- a/lib/mpl_toolkits/axes_grid1/inset_locator.py
+++ b/lib/mpl_toolkits/axes_grid1/inset_locator.py
@@ -69,6 +69,8 @@ def draw(self, renderer):
         raise RuntimeError("No draw method should be called")
 
     def __call__(self, ax, renderer):
+        if renderer is None:
+            renderer = ax.figure._get_renderer()
         self.axes = ax
         bbox = self.get_window_extent(renderer)
         px, py = self.get_offset(bbox.width, bbox.height, 0, 0, renderer)
diff --git a/lib/mpl_toolkits/axes_grid1/tests/test_axes_grid1.py b/lib/mpl_toolkits/axes_grid1/tests/test_axes_grid1.py
index b61574787772..704130804c84 100644
--- a/lib/mpl_toolkits/axes_grid1/tests/test_axes_grid1.py
+++ b/lib/mpl_toolkits/axes_grid1/tests/test_axes_grid1.py
@@ -1,4 +1,5 @@
 from itertools import product
+import io
 import platform
 
 import matplotlib as mpl
@@ -247,6 +248,15 @@ def test_inset_axes_complete():
                          bbox_transform=ax.transAxes)
 
 
+def test_inset_axes_tight():
+    # gh-26287 found that inset_axes raised with bbox_inches=tight
+    fig, ax = plt.subplots()
+    inset_axes(ax, width=1.3, height=0.9)
+
+    f = io.BytesIO()
+    fig.savefig(f, bbox_inches="tight")
+
+
 @image_comparison(['fill_facecolor.png'], remove_text=True, style='mpl20')
 def test_fill_facecolor():
     fig, ax = plt.subplots(1, 5)
