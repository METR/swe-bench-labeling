{"instance_id": "pytest-dev__pytest-7205", "score": "C", "diff": "diff --git a/src/_pytest/setuponly.py b/src/_pytest/setuponly.py\nindex c9cc589ff..9fc218a3e 100644\n--- a/src/_pytest/setuponly.py\n+++ b/src/_pytest/setuponly.py\n@@ -1,4 +1,5 @@\n import pytest\n+from _pytest._io.saferepr import saferepr\n \n \n def pytest_addoption(parser):\n@@ -66,7 +67,7 @@ def _show_fixture_action(fixturedef, msg):\n             tw.write(\" (fixtures used: {})\".format(\", \".join(deps)))\n \n     if hasattr(fixturedef, \"cached_param\"):\n-        tw.write(\"[{}]\".format(fixturedef.cached_param))\n+        tw.write(\"[{}]\".format(saferepr(fixturedef.cached_param)))\n \n     tw.flush()\n \n", "gold_standard_diff": "From 903e2ab6eef5a99625f4ef58115c9455b018feda Mon Sep 17 00:00:00 2001\nFrom: Pavel Karateev <lancelote.du.lac@gmail.com>\nDate: Sat, 9 May 2020 13:57:17 +0300\nSubject: [PATCH 1/8] Fix #7126 - saferepr for bytes params\n\nbytes parametrize parameters cause error when --setup-show is used\nand Python is called with -bb flag\n---\n AUTHORS                   |  1 +\n changelog/7126.bugfix.rst |  3 +++\n src/_pytest/setuponly.py  |  7 ++++++-\n testing/test_setuponly.py | 18 ++++++++++++++++++\n 4 files changed, 28 insertions(+), 1 deletion(-)\n create mode 100644 changelog/7126.bugfix.rst\n\ndiff --git a/AUTHORS b/AUTHORS\nindex b59ebc2a27f..68f156862c5 100644\n--- a/AUTHORS\n+++ b/AUTHORS\n@@ -216,6 +216,7 @@ Ond\u0159ej S\u00fakup\n Oscar Benjamin\n Patrick Hayes\n Pauli Virtanen\n+Pavel Karateev\n Pawe\u0142 Adamczak\n Pedro Algarvio\n Philipp Loose\ndiff --git a/changelog/7126.bugfix.rst b/changelog/7126.bugfix.rst\nnew file mode 100644\nindex 00000000000..6817ee21192\n--- /dev/null\n+++ b/changelog/7126.bugfix.rst\n@@ -0,0 +1,3 @@\n+Use ``saferepr`` to format bytes ``parametrize`` parameters  for ``--setup-show``\n+output to prevent errors when Python is called with ``-bb`` to catch bytearray with\n+unicode comparison.\ndiff --git a/src/_pytest/setuponly.py b/src/_pytest/setuponly.py\nindex c9cc589ffee..e18208e59a9 100644\n--- a/src/_pytest/setuponly.py\n+++ b/src/_pytest/setuponly.py\n@@ -1,4 +1,5 @@\n import pytest\n+from _pytest._io.saferepr import saferepr\n \n \n def pytest_addoption(parser):\n@@ -66,7 +67,11 @@ def _show_fixture_action(fixturedef, msg):\n             tw.write(\" (fixtures used: {})\".format(\", \".join(deps)))\n \n     if hasattr(fixturedef, \"cached_param\"):\n-        tw.write(\"[{}]\".format(fixturedef.cached_param))\n+        if isinstance(fixturedef.cached_param, bytes):\n+            param = saferepr(fixturedef.cached_param, maxsize=42)\n+        else:\n+            param = fixturedef.cached_param\n+        tw.write(\"[{}]\".format(param))\n \n     tw.flush()\n \ndiff --git a/testing/test_setuponly.py b/testing/test_setuponly.py\nindex e26a33dee38..779c17fbd23 100644\n--- a/testing/test_setuponly.py\n+++ b/testing/test_setuponly.py\n@@ -1,3 +1,5 @@\n+import sys\n+\n import pytest\n from _pytest.config import ExitCode\n \n@@ -292,3 +294,19 @@ def test_arg(arg):\n         ]\n     )\n     assert result.ret == ExitCode.INTERRUPTED\n+\n+\n+def test_parametrize_no_comparing_bytearray_error(testdir):\n+    test_file = testdir.makepyfile(\n+        \"\"\"\n+        import pytest\n+\n+        @pytest.mark.parametrize('data', [b'Hello World'])\n+        def test_data(data):\n+            pass\n+        \"\"\"\n+    )\n+    result = testdir.run(\n+        sys.executable, \"-bb\", \"-m\", \"pytest\", \"--setup-show\", str(test_file)\n+    )\n+    assert result.ret == 0\n\nFrom a2280d39ec9ff030abcbaba8e246c269587b9bea Mon Sep 17 00:00:00 2001\nFrom: Pavel Karateev <lancelote.du.lac@gmail.com>\nDate: Sat, 9 May 2020 14:14:23 +0300\nSubject: [PATCH 2/8] #7126, use past tense in changelog\n\n---\n changelog/7126.bugfix.rst | 6 +++---\n 1 file changed, 3 insertions(+), 3 deletions(-)\n\ndiff --git a/changelog/7126.bugfix.rst b/changelog/7126.bugfix.rst\nindex 6817ee21192..ad3368d77f1 100644\n--- a/changelog/7126.bugfix.rst\n+++ b/changelog/7126.bugfix.rst\n@@ -1,3 +1,3 @@\n-Use ``saferepr`` to format bytes ``parametrize`` parameters  for ``--setup-show``\n-output to prevent errors when Python is called with ``-bb`` to catch bytearray with\n-unicode comparison.\n+Switched to ``saferepr`` to format bytes ``parametrize`` parameters\n+for ``--setup-show`` output to prevent errors when Python is called with ``-bb``\n+to catch bytearray with unicode comparison.\n\nFrom feb7a5f0d1589bdc82473537e9017ff832e684f3 Mon Sep 17 00:00:00 2001\nFrom: Pavel Karateev <lancelote.du.lac@gmail.com>\nDate: Sun, 10 May 2020 12:11:59 +0300\nSubject: [PATCH 3/8] Omit internal solution details\n\n---\n changelog/7126.bugfix.rst | 5 ++---\n 1 file changed, 2 insertions(+), 3 deletions(-)\n\ndiff --git a/changelog/7126.bugfix.rst b/changelog/7126.bugfix.rst\nindex ad3368d77f1..a547688cb46 100644\n--- a/changelog/7126.bugfix.rst\n+++ b/changelog/7126.bugfix.rst\n@@ -1,3 +1,2 @@\n-Switched to ``saferepr`` to format bytes ``parametrize`` parameters\n-for ``--setup-show`` output to prevent errors when Python is called with ``-bb``\n-to catch bytearray with unicode comparison.\n+``--setup-show`` now doesn't raise an error if bytearray is used as ``parametrize``\n+parameter when Python is called with ``-bb`` flag.\n\nFrom 6b26f0f890f161f91d81b443468f10de1d5046a2 Mon Sep 17 00:00:00 2001\nFrom: Pavel Karateev <lancelote.du.lac@gmail.com>\nDate: Sun, 10 May 2020 12:19:52 +0300\nSubject: [PATCH 4/8] Rename test method and reference issue\n\n---\n testing/test_setuponly.py | 3 ++-\n 1 file changed, 2 insertions(+), 1 deletion(-)\n\ndiff --git a/testing/test_setuponly.py b/testing/test_setuponly.py\nindex 779c17fbd23..57c95ae06ae 100644\n--- a/testing/test_setuponly.py\n+++ b/testing/test_setuponly.py\n@@ -296,7 +296,8 @@ def test_arg(arg):\n     assert result.ret == ExitCode.INTERRUPTED\n \n \n-def test_parametrize_no_comparing_bytearray_error(testdir):\n+def test_show_fixture_action_with_bytearrays(testdir):\n+    # Issue 7126, BytesWarning when using --setup-show with bytes parameter\n     test_file = testdir.makepyfile(\n         \"\"\"\n         import pytest\n\nFrom 7b196747ddb55dd484ad5dfa8276d2d65cd737d4 Mon Sep 17 00:00:00 2001\nFrom: Pavel Karateev <lancelote.du.lac@gmail.com>\nDate: Sun, 10 May 2020 12:47:26 +0300\nSubject: [PATCH 5/8] Use saferepr for all types\n\n---\n src/_pytest/setuponly.py | 6 +-----\n 1 file changed, 1 insertion(+), 5 deletions(-)\n\ndiff --git a/src/_pytest/setuponly.py b/src/_pytest/setuponly.py\nindex e18208e59a9..9e4cd951947 100644\n--- a/src/_pytest/setuponly.py\n+++ b/src/_pytest/setuponly.py\n@@ -67,11 +67,7 @@ def _show_fixture_action(fixturedef, msg):\n             tw.write(\" (fixtures used: {})\".format(\", \".join(deps)))\n \n     if hasattr(fixturedef, \"cached_param\"):\n-        if isinstance(fixturedef.cached_param, bytes):\n-            param = saferepr(fixturedef.cached_param, maxsize=42)\n-        else:\n-            param = fixturedef.cached_param\n-        tw.write(\"[{}]\".format(param))\n+        tw.write(\"[{}]\".format(saferepr(fixturedef.cached_param, maxsize=42)))\n \n     tw.flush()\n \n\nFrom 184528d0c28f2cde73a0457414c55218fd6a2ddf Mon Sep 17 00:00:00 2001\nFrom: Pavel Karateev <lancelote.du.lac@gmail.com>\nDate: Sun, 10 May 2020 13:06:36 +0300\nSubject: [PATCH 6/8] Fix tests to expected repr output\n\n---\n testing/test_setuponly.py | 14 ++++++++------\n 1 file changed, 8 insertions(+), 6 deletions(-)\n\ndiff --git a/testing/test_setuponly.py b/testing/test_setuponly.py\nindex 57c95ae06ae..9b0bb909bf1 100644\n--- a/testing/test_setuponly.py\n+++ b/testing/test_setuponly.py\n@@ -148,10 +148,10 @@ def test_arg1(arg_other):\n \n     result.stdout.fnmatch_lines(\n         [\n-            \"SETUP    S arg_same?foo?\",\n-            \"TEARDOWN S arg_same?foo?\",\n-            \"SETUP    S arg_same?bar?\",\n-            \"TEARDOWN S arg_same?bar?\",\n+            \"SETUP    S arg_same?'foo'?\",\n+            \"TEARDOWN S arg_same?'foo'?\",\n+            \"SETUP    S arg_same?'bar'?\",\n+            \"TEARDOWN S arg_same?'bar'?\",\n         ]\n     )\n \n@@ -181,7 +181,7 @@ def test_arg1(arg_other):\n     assert result.ret == 0\n \n     result.stdout.fnmatch_lines(\n-        [\"SETUP    S arg_same?spam?\", \"SETUP    S arg_same?ham?\"]\n+        [\"SETUP    S arg_same?'spam'?\", \"SETUP    S arg_same?'ham'?\"]\n     )\n \n \n@@ -200,7 +200,9 @@ def test_foobar(foobar):\n     result = testdir.runpytest(mode, p)\n     assert result.ret == 0\n \n-    result.stdout.fnmatch_lines([\"*SETUP    F foobar?FOO?\", \"*SETUP    F foobar?BAR?\"])\n+    result.stdout.fnmatch_lines(\n+        [\"*SETUP    F foobar?'FOO'?\", \"*SETUP    F foobar?'BAR'?\"]\n+    )\n \n \n def test_dynamic_fixture_request(testdir):\n\nFrom 17857b67df4c4cf1ba7def1d896426e583e4120c Mon Sep 17 00:00:00 2001\nFrom: Pavel Karateev <lancelote.du.lac@gmail.com>\nDate: Sun, 10 May 2020 16:58:22 +0300\nSubject: [PATCH 7/8] Better changelog wording\n\nCo-authored-by: Ran Benita <ran@unusedvar.com>\n---\n changelog/7126.bugfix.rst | 4 ++--\n 1 file changed, 2 insertions(+), 2 deletions(-)\n\ndiff --git a/changelog/7126.bugfix.rst b/changelog/7126.bugfix.rst\nindex a547688cb46..1a85e899781 100644\n--- a/changelog/7126.bugfix.rst\n+++ b/changelog/7126.bugfix.rst\n@@ -1,2 +1,2 @@\n-``--setup-show`` now doesn't raise an error if bytearray is used as ``parametrize``\n-parameter when Python is called with ``-bb`` flag.\n+``--setup-show`` now doesn't raise an error when a bytes value is used as a ``parametrize``\n+parameter when Python is called with the ``-bb`` flag.\n\nFrom 8bd3f1a72bf794e919f0fe2d06b426729f53b092 Mon Sep 17 00:00:00 2001\nFrom: Pavel Karateev <lancelote.du.lac@gmail.com>\nDate: Sun, 10 May 2020 16:59:20 +0300\nSubject: [PATCH 8/8] Better test method name\n\nCo-authored-by: Ran Benita <ran@unusedvar.com>\n---\n testing/test_setuponly.py | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/testing/test_setuponly.py b/testing/test_setuponly.py\nindex 9b0bb909bf1..221c32a310b 100644\n--- a/testing/test_setuponly.py\n+++ b/testing/test_setuponly.py\n@@ -298,7 +298,7 @@ def test_arg(arg):\n     assert result.ret == ExitCode.INTERRUPTED\n \n \n-def test_show_fixture_action_with_bytearrays(testdir):\n+def test_show_fixture_action_with_bytes(testdir):\n     # Issue 7126, BytesWarning when using --setup-show with bytes parameter\n     test_file = testdir.makepyfile(\n         \"\"\"\n", "gold_standard_pr_link": "https://github.com/pytest-dev/pytest/pull/7205"}