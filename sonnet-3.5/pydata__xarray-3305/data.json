{"instance_id": "pydata__xarray-3305", "score": "C", "diff": "diff --git a/xarray/core/dataarray.py b/xarray/core/dataarray.py\nindex 807badde..8c7ac305 100644\n--- a/xarray/core/dataarray.py\n+++ b/xarray/core/dataarray.py\n@@ -2875,7 +2875,12 @@ class DataArray(AbstractArray, DataWithCoords):\n         ds = self._to_temp_dataset().quantile(\n             q, dim=dim, keep_attrs=keep_attrs, interpolation=interpolation\n         )\n-        return self._from_temp_dataset(ds)\n+        result = self._from_temp_dataset(ds)\n+        \n+        if keep_attrs:\n+            result.attrs = self.attrs.copy()\n+        \n+        return result\n \n     def rank(\n         self, dim: Hashable, pct: bool = False, keep_attrs: bool = None\n", "gold_standard_diff": "From 7cb22f477fa39604fff569ba98cf62bc3aefa80d Mon Sep 17 00:00:00 2001\nFrom: David Huard <huard.david@ouranos.ca>\nDate: Thu, 12 Sep 2019 15:13:24 -0400\nSubject: [PATCH 1/4] Added `keep_attrs` argument to Variable.quantile.\n TestDataArray.test_quantile now checks for attributes in output.\n\n---\n xarray/core/dataset.py         |  2 +-\n xarray/core/variable.py        | 17 +++++++++++++----\n xarray/tests/test_dataarray.py |  3 ++-\n 3 files changed, 16 insertions(+), 6 deletions(-)\n\ndiff --git a/xarray/core/dataset.py b/xarray/core/dataset.py\nindex d6f0da42722..4b2b3580d6a 100644\n--- a/xarray/core/dataset.py\n+++ b/xarray/core/dataset.py\n@@ -4768,7 +4768,7 @@ def quantile(\n                             # the former is often more efficient\n                             reduce_dims = None\n                         variables[name] = var.quantile(\n-                            q, dim=reduce_dims, interpolation=interpolation\n+                            q, dim=reduce_dims, interpolation=interpolation, keep_attrs=keep_attrs\n                         )\n \n             else:\ndiff --git a/xarray/core/variable.py b/xarray/core/variable.py\nindex 2e9906ce5ae..66ce50a05b9 100644\n--- a/xarray/core/variable.py\n+++ b/xarray/core/variable.py\n@@ -1592,7 +1592,7 @@ def no_conflicts(self, other):\n         \"\"\"\n         return self.broadcast_equals(other, equiv=duck_array_ops.array_notnull_equiv)\n \n-    def quantile(self, q, dim=None, interpolation=\"linear\"):\n+    def quantile(self, q, dim=None, interpolation=\"linear\", keep_attrs=None):\n         \"\"\"Compute the qth quantile of the data along the specified dimension.\n \n         Returns the qth quantiles(s) of the array elements.\n@@ -1615,6 +1615,10 @@ def quantile(self, q, dim=None, interpolation=\"linear\"):\n                 * higher: ``j``.\n                 * nearest: ``i`` or ``j``, whichever is nearest.\n                 * midpoint: ``(i + j) / 2``.\n+        keep_attrs : bool, optional\n+            If True (default), the variable's attributes (`attrs`) will\n+            be copied from the original object to the new one.  If False,\n+            the new object will be returned without attributes.\n \n         Returns\n         -------\n@@ -1623,7 +1627,7 @@ def quantile(self, q, dim=None, interpolation=\"linear\"):\n             is a scalar. If multiple percentiles are given, first axis of\n             the result corresponds to the quantile and a quantile dimension\n             is added to the return array. The other dimensions are the\n-             dimensions that remain after the reduction of the array.\n+            dimensions that remain after the reduction of the array.\n \n         See Also\n         --------\n@@ -1651,14 +1655,19 @@ def quantile(self, q, dim=None, interpolation=\"linear\"):\n             axis = None\n             new_dims = []\n \n-        # only add the quantile dimension if q is array like\n+        # Only add the quantile dimension if q is array-like\n         if q.ndim != 0:\n             new_dims = [\"quantile\"] + new_dims\n \n         qs = np.nanpercentile(\n             self.data, q * 100.0, axis=axis, interpolation=interpolation\n         )\n-        return Variable(new_dims, qs)\n+\n+        if keep_attrs is None:\n+            keep_attrs = _get_keep_attrs(default=True)\n+        attrs = self._attrs if keep_attrs else None\n+\n+        return Variable(new_dims, qs, attrs)\n \n     def rank(self, dim, pct=False):\n         \"\"\"Ranks the data.\ndiff --git a/xarray/tests/test_dataarray.py b/xarray/tests/test_dataarray.py\nindex 8c01ef9a68c..c9e15912daa 100644\n--- a/xarray/tests/test_dataarray.py\n+++ b/xarray/tests/test_dataarray.py\n@@ -2304,11 +2304,12 @@ def test_quantile(self):\n             for axis, dim in zip(\n                 [None, 0, [0], [0, 1]], [None, \"x\", [\"x\"], [\"x\", \"y\"]]\n             ):\n-                actual = self.dv.quantile(q, dim=dim)\n+                actual = DataArray(self.va).quantile(q, dim=dim, keep_attrs=True)\n                 expected = np.nanpercentile(\n                     self.dv.values, np.array(q) * 100, axis=axis\n                 )\n                 np.testing.assert_allclose(actual.values, expected)\n+                assert actual.attrs == self.attrs\n \n     def test_reduce_keep_attrs(self):\n         # Test dropped attrs\n\nFrom d1fa7b9df881eab5d977820b12f58808da53dfd6 Mon Sep 17 00:00:00 2001\nFrom: David Huard <huard.david@ouranos.ca>\nDate: Thu, 12 Sep 2019 15:17:34 -0400\nSubject: [PATCH 2/4] black\n\n---\n xarray/core/dataset.py | 5 ++++-\n 1 file changed, 4 insertions(+), 1 deletion(-)\n\ndiff --git a/xarray/core/dataset.py b/xarray/core/dataset.py\nindex 4b2b3580d6a..fae086e85ac 100644\n--- a/xarray/core/dataset.py\n+++ b/xarray/core/dataset.py\n@@ -4768,7 +4768,10 @@ def quantile(\n                             # the former is often more efficient\n                             reduce_dims = None\n                         variables[name] = var.quantile(\n-                            q, dim=reduce_dims, interpolation=interpolation, keep_attrs=keep_attrs\n+                            q,\n+                            dim=reduce_dims,\n+                            interpolation=interpolation,\n+                            keep_attrs=keep_attrs,\n                         )\n \n             else:\n\nFrom 234d280b67b72a077e3a6dc074992e78b8b96391 Mon Sep 17 00:00:00 2001\nFrom: David Huard <huard.david@ouranos.ca>\nDate: Thu, 12 Sep 2019 15:25:00 -0400\nSubject: [PATCH 3/4] updated whats new.\n\n---\n doc/whats-new.rst | 20 +++++++++++---------\n 1 file changed, 11 insertions(+), 9 deletions(-)\n\ndiff --git a/doc/whats-new.rst b/doc/whats-new.rst\nindex d81986cb948..ab4b17ff16d 100644\n--- a/doc/whats-new.rst\n+++ b/doc/whats-new.rst\n@@ -26,8 +26,8 @@ Breaking changes\n \n - The ``isel_points`` and ``sel_points`` methods are removed, having been deprecated\n   since v0.10.0. These are redundant with the ``isel`` / ``sel`` methods.\n-  See :ref:`vectorized_indexing` for the details \n-  By `Maximilian Roos <https://github.com/max-sixty>`_ \n+  See :ref:`vectorized_indexing` for the details\n+  By `Maximilian Roos <https://github.com/max-sixty>`_\n - The ``inplace`` kwarg for public methods now raises an error, having been deprecated\n   since v0.11.0.\n   By `Maximilian Roos <https://github.com/max-sixty>`_\n@@ -52,12 +52,12 @@ Breaking changes\n     error in a later release.\n \n   (:issue:`3250`) by `Guido Imperiale <https://github.com/crusaderky>`_.\n-- :py:meth:`~Dataset.to_dataset` requires ``name`` to be passed as a kwarg (previously ambiguous \n+- :py:meth:`~Dataset.to_dataset` requires ``name`` to be passed as a kwarg (previously ambiguous\n   positional arguments were deprecated)\n - Reindexing with variables of a different dimension now raise an error (previously deprecated)\n-- :py:func:`~xarray.broadcast_array` is removed (previously deprecated in favor of \n+- :py:func:`~xarray.broadcast_array` is removed (previously deprecated in favor of\n   :py:func:`~xarray.broadcast`)\n-- :py:meth:`~Variable.expand_dims` is removed (previously deprecated in favor of \n+- :py:meth:`~Variable.expand_dims` is removed (previously deprecated in favor of\n   :py:meth:`~Variable.set_dims`)\n \n New functions/methods\n@@ -90,7 +90,7 @@ New functions/methods\n   and `Maximilian Roos <https://github.com/max-sixty>`_.\n \n - Added :py:meth:`DataArray.broadcast_like` and :py:meth:`Dataset.broadcast_like`.\n-  By `Deepak Cherian <https://github.com/dcherian>`_ and `David Mertz \n+  By `Deepak Cherian <https://github.com/dcherian>`_ and `David Mertz\n   <http://github.com/DavidMertz>`_.\n \n - Dataset plotting API for visualizing dependencies between two `DataArray`s!\n@@ -131,14 +131,14 @@ Enhancements\n   :py:meth:`DataArray.set_index`, as well are more specific error messages\n   when the user passes invalid arguments (:issue:`3176`).\n   By `Gregory Gundersen <https://github.com/gwgundersen>`_.\n-  \n+\n - :py:func:`filter_by_attrs` now filters the coordinates as well as the variables. By `Spencer Jones <https://github.com/cspencerjones>`_.\n \n Bug fixes\n ~~~~~~~~~\n \n-- Improve \"missing dimensions\" error message for :py:func:`~xarray.apply_ufunc` \n-  (:issue:`2078`). \n+- Improve \"missing dimensions\" error message for :py:func:`~xarray.apply_ufunc`\n+  (:issue:`2078`).\n   By `Rick Russotto <https://github.com/rdrussotto>`_.\n - :py:meth:`~xarray.DataArray.assign_coords` now supports dictionary arguments\n   (:issue:`3231`).\n@@ -170,6 +170,8 @@ Bug fixes\n   dask compute (:issue:`3237`). By `Ulrich Herter <https://github.com/ulijh>`_.\n - Plots in 2 dimensions (pcolormesh, contour) now allow to specify levels as numpy\n   array (:issue:`3284`). By `Mathias Hauser <https://github.com/mathause>`_.\n+- Fixed bug in :meth:`DataArray.quantile` failing to keep attributes when\n+  `keep_attrs` was True (:issue:`3304`). By David Huard <https://github.com/huard>`_.\n \n .. _whats-new.0.12.3:\n \n\nFrom f4552adc2f9c21cd58d6bdee7eb29f7d0f1d6bd3 Mon Sep 17 00:00:00 2001\nFrom: David Huard <huard.david@ouranos.ca>\nDate: Thu, 12 Sep 2019 16:16:05 -0400\nSubject: [PATCH 4/4] removed vestigial comment. Switched default\n Variable.quantile keep_attrs to False.\n\n---\n xarray/core/variable.py        | 8 ++++----\n xarray/tests/test_dataarray.py | 1 -\n 2 files changed, 4 insertions(+), 5 deletions(-)\n\ndiff --git a/xarray/core/variable.py b/xarray/core/variable.py\nindex 66ce50a05b9..b4b01f7ee49 100644\n--- a/xarray/core/variable.py\n+++ b/xarray/core/variable.py\n@@ -1616,9 +1616,9 @@ def quantile(self, q, dim=None, interpolation=\"linear\", keep_attrs=None):\n                 * nearest: ``i`` or ``j``, whichever is nearest.\n                 * midpoint: ``(i + j) / 2``.\n         keep_attrs : bool, optional\n-            If True (default), the variable's attributes (`attrs`) will\n-            be copied from the original object to the new one.  If False,\n-            the new object will be returned without attributes.\n+            If True, the variable's attributes (`attrs`) will be copied from\n+            the original object to the new one.  If False (default), the new\n+            object will be returned without attributes.\n \n         Returns\n         -------\n@@ -1664,7 +1664,7 @@ def quantile(self, q, dim=None, interpolation=\"linear\", keep_attrs=None):\n         )\n \n         if keep_attrs is None:\n-            keep_attrs = _get_keep_attrs(default=True)\n+            keep_attrs = _get_keep_attrs(default=False)\n         attrs = self._attrs if keep_attrs else None\n \n         return Variable(new_dims, qs, attrs)\ndiff --git a/xarray/tests/test_dataarray.py b/xarray/tests/test_dataarray.py\nindex c9e15912daa..dd6d7f8fefc 100644\n--- a/xarray/tests/test_dataarray.py\n+++ b/xarray/tests/test_dataarray.py\n@@ -2298,7 +2298,6 @@ def test_reduce_out(self):\n         with pytest.raises(TypeError):\n             orig.mean(out=np.ones(orig.shape))\n \n-    # skip due to bug in older versions of numpy.nanpercentile\n     def test_quantile(self):\n         for q in [0.25, [0.50], [0.25, 0.75]]:\n             for axis, dim in zip(\n", "gold_standard_pr_link": "https://github.com/pydata/xarray/pull/3305"}