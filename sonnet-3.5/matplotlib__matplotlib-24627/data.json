{"instance_id": "matplotlib__matplotlib-24627", "score": "I", "diff": "diff --git a/lib/matplotlib/axes/_base.py b/lib/matplotlib/axes/_base.py\nindex 90b0bf117e..b5ea114805 100644\n--- a/lib/matplotlib/axes/_base.py\n+++ b/lib/matplotlib/axes/_base.py\n@@ -1401,6 +1401,12 @@ class _AxesBase(martist.Artist):\n         else:\n             self.__clear()\n \n+    def cla(self):\n+        \"\"\"Clear the Axes.\"\"\"\n+        # Act as an alias, or as the superclass implementation depending on the\n+        # subclass implementation.\n+        if self._subclass_uses_cla:\n+            self.__clear()\n     def cla(self):\n         \"\"\"Clear the Axes.\"\"\"\n         # Act as an alias, or as the superclass implementation depending on the\n@@ -1409,10 +1415,10 @@ class _AxesBase(martist.Artist):\n             self.__clear()\n         else:\n             self.clear()\n-\n-    class ArtistList(MutableSequence):\n-        \"\"\"\n-        A sublist of Axes children based on their type.\n+        \n+        # Unset .axes attribute of deparented artists\n+        for artist in self.get_children():\n+            artist.axes = None\n \n         The type-specific children sublists will become immutable in\n         Matplotlib 3.7. Then, these artist lists will likely be replaced by\ndiff --git a/lib/matplotlib/figure.py b/lib/matplotlib/figure.py\nindex 6c18ba1a64..b9f51e2650 100644\n--- a/lib/matplotlib/figure.py\n+++ b/lib/matplotlib/figure.py\n@@ -929,8 +929,18 @@ default: %(va)s\n         _break_share_link(ax, ax._twinned_axes)\n \n     def clear(self, keep_observers=False):\n-        \"\"\"\n-        Clear the figure.\n+        \"\"\"Clear the figure.\"\"\"\n+        # Unset .figure attribute of deparented artists\n+        for ax in self.axes:\n+            for artist in ax.get_children():\n+                artist.figure = None\n+                artist.axes = None\n+        \n+        # Original clear implementation\n+        super().clear(keep_observers=keep_observers)\n+        toolbar = self.canvas.toolbar\n+        if toolbar is not None:\n+            toolbar.update()\n \n         Parameters\n         ----------\n@@ -3039,10 +3049,15 @@ class Figure(FigureBase):\n         self.set_size_inches(self.get_figwidth(), val, forward=forward)\n \n     def clear(self, keep_observers=False):\n-        # docstring inherited\n+        \"\"\"Clear the figure.\"\"\"\n+        # Unset .figure attribute of deparented artists\n+        for ax in self.axes:\n+            for artist in ax.get_children():\n+                artist.figure = None\n+                artist.axes = None\n+        \n+        # Original clear implementation\n         super().clear(keep_observers=keep_observers)\n-        # FigureBase.clear does not clear toolbars, as\n-        # only Figure can have toolbars\n         toolbar = self.canvas.toolbar\n         if toolbar is not None:\n             toolbar.update()\n", "gold_standard_diff": "From ffcc8d314c8a47772ba541027f138ee18155d7e6 Mon Sep 17 00:00:00 2001\nFrom: Thomas A Caswell <tcaswell@gmail.com>\nDate: Sun, 4 Dec 2022 18:53:58 -0500\nSubject: [PATCH 1/3] MNT: when clearing an Axes via clear/cla fully detach\n children\n\nReset the Axes and Figure of the children to None to help break cycles.\n\nCloses #6982\n---\n lib/matplotlib/axes/_base.py      |  3 +++\n lib/matplotlib/tests/test_axes.py | 13 +++++++++++++\n 2 files changed, 16 insertions(+)\n\ndiff --git a/lib/matplotlib/axes/_base.py b/lib/matplotlib/axes/_base.py\nindex 574310ea763a..1f46c6f7444c 100644\n--- a/lib/matplotlib/axes/_base.py\n+++ b/lib/matplotlib/axes/_base.py\n@@ -1315,7 +1315,10 @@ def __clear(self):\n         self._get_patches_for_fill = _process_plot_var_args(self, 'fill')\n \n         self._gridOn = mpl.rcParams['axes.grid']\n+        old_children = getattr(self, '_children', [])\n         self._children = []\n+        for chld in old_children:\n+            chld.axes = chld.figure = None\n         self._mouseover_set = _OrderedSet()\n         self.child_axes = []\n         self._current_image = None  # strictly for pyplot via _sci, _gci\ndiff --git a/lib/matplotlib/tests/test_axes.py b/lib/matplotlib/tests/test_axes.py\nindex deb6c3fb2ba1..a5f1be66ce1c 100644\n--- a/lib/matplotlib/tests/test_axes.py\n+++ b/lib/matplotlib/tests/test_axes.py\n@@ -8359,6 +8359,19 @@ def test_extent_units():\n         im.set_extent([2, 12, date_first, date_last], clip=False)\n \n \n+def test_cla_clears_chlidren_axes_and_fig():\n+    fig, ax = plt.subplots()\n+    lines = ax.plot([], [], [], [])\n+    img = ax.imshow([[1]])\n+    for art in lines + [img]:\n+        assert art.axes is ax\n+        assert art.figure is fig\n+    ax.clear()\n+    for art in lines + [img]:\n+        assert art.axes is None\n+        assert art.figure is None\n+\n+\n def test_scatter_color_repr_error():\n \n     def get_next_color():\n\nFrom 146b478cc16e648fbd3e3f5629a4b9fed0e53b0d Mon Sep 17 00:00:00 2001\nFrom: Thomas A Caswell <tcaswell@gmail.com>\nDate: Mon, 5 Dec 2022 10:01:51 -0500\nSubject: [PATCH 2/3] MNT: compress swap to one line\n\n---\n lib/matplotlib/axes/_base.py | 3 +--\n 1 file changed, 1 insertion(+), 2 deletions(-)\n\ndiff --git a/lib/matplotlib/axes/_base.py b/lib/matplotlib/axes/_base.py\nindex 1f46c6f7444c..4ea2b2433706 100644\n--- a/lib/matplotlib/axes/_base.py\n+++ b/lib/matplotlib/axes/_base.py\n@@ -1315,8 +1315,7 @@ def __clear(self):\n         self._get_patches_for_fill = _process_plot_var_args(self, 'fill')\n \n         self._gridOn = mpl.rcParams['axes.grid']\n-        old_children = getattr(self, '_children', [])\n-        self._children = []\n+        old_children, self._children = self._children, []\n         for chld in old_children:\n             chld.axes = chld.figure = None\n         self._mouseover_set = _OrderedSet()\n\nFrom c77fa4c05b52481062c60d5b26a88ceadd753674 Mon Sep 17 00:00:00 2001\nFrom: Thomas A Caswell <tcaswell@gmail.com>\nDate: Wed, 7 Dec 2022 16:12:50 -0500\nSubject: [PATCH 3/3] DOC: fix spelling in test\n\nCo-authored-by: Elliott Sales de Andrade <quantum.analyst@gmail.com>\n---\n lib/matplotlib/tests/test_axes.py | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/lib/matplotlib/tests/test_axes.py b/lib/matplotlib/tests/test_axes.py\nindex a5f1be66ce1c..680602f706e7 100644\n--- a/lib/matplotlib/tests/test_axes.py\n+++ b/lib/matplotlib/tests/test_axes.py\n@@ -8359,7 +8359,7 @@ def test_extent_units():\n         im.set_extent([2, 12, date_first, date_last], clip=False)\n \n \n-def test_cla_clears_chlidren_axes_and_fig():\n+def test_cla_clears_children_axes_and_fig():\n     fig, ax = plt.subplots()\n     lines = ax.plot([], [], [], [])\n     img = ax.imshow([[1]])\n", "gold_standard_pr_link": "https://github.com/matplotlib/matplotlib/pull/24627"}