{"instance_id": "django__django-15741", "score": "C", "diff": "diff --git a/django/utils/formats.py b/django/utils/formats.py\nindex 3f38322d84..04f7a2f7b9 100644\n--- a/django/utils/formats.py\n+++ b/django/utils/formats.py\n@@ -106,6 +106,11 @@ def get_format(format_type, lang=None, use_l10n=None):\n     If use_l10n is provided and is not None, it forces the value to\n     be localized (or not), overriding the value of settings.USE_L10N.\n     \"\"\"\n+    from django.utils.functional import Promise\n+    \n+    if isinstance(format_type, Promise):\n+        format_type = str(format_type)\n+    \n     if use_l10n is None:\n         try:\n             use_l10n = settings._USE_L10N_INTERNAL\n@@ -125,9 +130,12 @@ def get_format(format_type, lang=None, use_l10n=None):\n     val = None\n     if use_l10n:\n         for module in get_format_modules(lang):\n-            val = getattr(module, format_type, None)\n-            if val is not None:\n-                break\n+            try:\n+                val = getattr(module, format_type)\n+                if val is not None:\n+                    break\n+            except AttributeError:\n+                pass\n     if val is None:\n         if format_type not in FORMAT_SETTINGS:\n             return format_type\n", "gold_standard_diff": "From 292f372768836e2aebc713064c5139e8067eebcb Mon Sep 17 00:00:00 2001\nFrom: Claude Paroz <claude@2xlibre.net>\nDate: Sat, 28 May 2022 11:52:06 +0200\nSubject: [PATCH] Fixed #33748 -- Fixed date template filter crash with lazy\n format.\n\nRegression in 659d2421c7adbbcd205604002d521d82d6b0b465.\n---\n django/utils/formats.py                        | 1 +\n tests/i18n/tests.py                            | 3 +++\n tests/template_tests/filter_tests/test_date.py | 5 +++++\n 3 files changed, 9 insertions(+)\n\ndiff --git a/django/utils/formats.py b/django/utils/formats.py\nindex 3f38322d84da..b0a66e4e25e1 100644\n--- a/django/utils/formats.py\n+++ b/django/utils/formats.py\n@@ -113,6 +113,7 @@ def get_format(format_type, lang=None, use_l10n=None):\n             use_l10n = settings.USE_L10N\n     if use_l10n and lang is None:\n         lang = get_language()\n+    format_type = str(format_type)  # format_type may be lazy.\n     cache_key = (format_type, lang)\n     try:\n         return _format_cache[cache_key]\ndiff --git a/tests/i18n/tests.py b/tests/i18n/tests.py\nindex 0093181f640f..d79cdcd34d9a 100644\n--- a/tests/i18n/tests.py\n+++ b/tests/i18n/tests.py\n@@ -1518,6 +1518,9 @@ def test_get_format_modules_lang(self):\n         with translation.override(\"de\", deactivate=True):\n             self.assertEqual(\".\", get_format(\"DECIMAL_SEPARATOR\", lang=\"en\"))\n \n+    def test_get_format_lazy_format(self):\n+        self.assertEqual(get_format(gettext_lazy(\"DATE_FORMAT\")), \"N j, Y\")\n+\n     def test_localize_templatetag_and_filter(self):\n         \"\"\"\n         Test the {% localize %} templatetag and the localize/unlocalize filters.\ndiff --git a/tests/template_tests/filter_tests/test_date.py b/tests/template_tests/filter_tests/test_date.py\nindex a7c694d50e5a..b998f83ba6bb 100644\n--- a/tests/template_tests/filter_tests/test_date.py\n+++ b/tests/template_tests/filter_tests/test_date.py\n@@ -72,6 +72,11 @@ def test_date09(self):\n         output = self.engine.render_to_string(\"date09\", {\"t\": time(0, 0)})\n         self.assertEqual(output, \"00:00\")\n \n+    @setup({\"datelazy\": '{{ t|date:_(\"H:i\") }}'})\n+    def test_date_lazy(self):\n+        output = self.engine.render_to_string(\"datelazy\", {\"t\": time(0, 0)})\n+        self.assertEqual(output, \"00:00\")\n+\n \n class FunctionTests(SimpleTestCase):\n     def test_date(self):\n", "gold_standard_pr_link": "https://github.com/django/django/pull/15741"}