{"instance_id": "matplotlib__matplotlib-24637", "score": "I", "diff": "diff --git a/lib/matplotlib/offsetbox.py b/lib/matplotlib/offsetbox.py\nindex efa34dd078..68bd08b511 100644\n--- a/lib/matplotlib/offsetbox.py\n+++ b/lib/matplotlib/offsetbox.py\n@@ -361,6 +361,9 @@ class OffsetBox(martist.Artist):\n         return mtransforms.Bbox.from_bounds(px - xd, py - yd, w, h)\n \n     def draw(self, renderer):\n+        if self.get_gid() is not None:\n+            renderer.start_rasterizing()\n+            renderer.set_gid(self.get_gid())\n         \"\"\"\n         Update the location of children if necessary and draw them\n         to the given *renderer*.\n@@ -546,6 +549,12 @@ class PaddedBox(OffsetBox):\n                 [(0, 0)])\n \n     def draw(self, renderer):\n+        if self.get_gid() is not None:\n+            renderer.start_rasterizing()\n+            renderer.set_gid(self.get_gid())\n+        if self.get_gid() is not None:\n+            renderer.start_rasterizing()\n+            renderer.set_gid(self.get_gid())\n         # docstring inherited\n         w, h, xdescent, ydescent, offsets = self.get_extent_offsets(renderer)\n         px, py = self.get_offset(w, h, xdescent, ydescent, renderer)\n@@ -659,6 +668,9 @@ class DrawingArea(OffsetBox):\n             a.set_figure(fig)\n \n     def draw(self, renderer):\n+        if self.get_gid() is not None:\n+            renderer.start_rasterizing()\n+            renderer.set_gid(self.get_gid())\n         # docstring inherited\n \n         dpi_cor = renderer.points_to_pixels(1.)\n@@ -798,6 +810,9 @@ class TextArea(OffsetBox):\n         return w, h, xd, yd\n \n     def draw(self, renderer):\n+        if self.get_gid() is not None:\n+            renderer.start_rasterizing()\n+            renderer.set_gid(self.get_gid())\n         # docstring inherited\n         self._text.draw(renderer)\n         _bbox_artist(self, renderer, fill=False, props=dict(pad=0.))\n@@ -880,6 +895,9 @@ class AuxTransformBox(OffsetBox):\n         return ub.width, ub.height, 0., 0.\n \n     def draw(self, renderer):\n+        if self.get_gid() is not None:\n+            renderer.start_rasterizing()\n+            renderer.set_gid(self.get_gid())\n         # docstring inherited\n         for c in self._children:\n             c.draw(renderer)\n@@ -1056,6 +1074,9 @@ class AnchoredOffsetbox(OffsetBox):\n             self.patch.set_mutation_scale(fontsize)\n \n     def draw(self, renderer):\n+        if self.get_gid() is not None:\n+            renderer.start_rasterizing()\n+            renderer.set_gid(self.get_gid())\n         # docstring inherited\n         if not self.get_visible():\n             return\n@@ -1202,6 +1223,12 @@ class OffsetImage(OffsetBox):\n         return w, h, 0, 0\n \n     def draw(self, renderer):\n+        if self.get_gid() is not None:\n+            renderer.start_rasterizing()\n+            renderer.set_gid(self.get_gid())\n+        if self.get_gid() is not None:\n+            renderer.start_rasterizing()\n+            renderer.set_gid(self.get_gid())\n         # docstring inherited\n         self.image.draw(renderer)\n         # bbox_artist(self, renderer, fill=False, props=dict(pad=0.))\n@@ -1446,7 +1473,12 @@ or callable, default: value of *xycoords*\n             patchA = self.arrowprops.get(\"patchA\", self.patch)\n             self.arrow_patch.set_patchA(patchA)\n \n-    def draw(self, renderer):\n+        if self.get_gid() is not None:\n+            renderer.start_rasterizing()\n+            renderer.set_gid(self.get_gid())\n+        if self.get_gid() is not None:\n+            renderer.start_rasterizing()\n+            renderer.set_gid(self.get_gid())\n         # docstring inherited\n         if renderer is not None:\n             self._renderer = renderer\n", "gold_standard_diff": "From 6f73eb1e7701bf51bbc1fe94d1f35ec7f814bb39 Mon Sep 17 00:00:00 2001\nFrom: saranti <tsarantis@proton.me>\nDate: Tue, 6 Dec 2022 14:37:23 +1100\nSubject: [PATCH 1/4] Fixes #20044 pass AnnotationBbox to renderer\n\n---\n lib/matplotlib/offsetbox.py | 2 ++\n 1 file changed, 2 insertions(+)\n\ndiff --git a/lib/matplotlib/offsetbox.py b/lib/matplotlib/offsetbox.py\nindex 059a6c8ae316..0ccc3149444b 100644\n--- a/lib/matplotlib/offsetbox.py\n+++ b/lib/matplotlib/offsetbox.py\n@@ -1446,6 +1446,7 @@ def draw(self, renderer):\n             self._renderer = renderer\n         if not self.get_visible() or not self._check_xy(renderer):\n             return\n+        renderer.open_group(self.__class__.__name__, gid=self.get_gid())\n         self.update_positions(renderer)\n         if self.arrow_patch is not None:\n             if self.arrow_patch.figure is None and self.figure is not None:\n@@ -1453,6 +1454,7 @@ def draw(self, renderer):\n             self.arrow_patch.draw(renderer)\n         self.patch.draw(renderer)\n         self.offsetbox.draw(renderer)\n+        renderer.close_group(self.__class__.__name__)\n         self.stale = False\n \n \n\nFrom c702a8f8994acaf044690d4dcb4c069da4d9b75f Mon Sep 17 00:00:00 2001\nFrom: saranti <tsarantis@proton.me>\nDate: Thu, 8 Dec 2022 22:54:01 +1100\nSubject: [PATCH 2/4] Squash past 7 commits - test gid gets passed to the\n renderer\n\n---\n lib/matplotlib/tests/test_backend_svg.py | 35 ++++++++++++++++++++++++\n 1 file changed, 35 insertions(+)\n\ndiff --git a/lib/matplotlib/tests/test_backend_svg.py b/lib/matplotlib/tests/test_backend_svg.py\nindex 680efd67379b..454dcc27ff76 100644\n--- a/lib/matplotlib/tests/test_backend_svg.py\n+++ b/lib/matplotlib/tests/test_backend_svg.py\n@@ -15,6 +15,7 @@\n from matplotlib.testing.decorators import check_figures_equal, image_comparison\n from matplotlib.testing._markers import needs_usetex\n from matplotlib import font_manager as fm\n+from matplotlib.offsetbox import (OffsetImage, AnnotationBbox)\n \n \n def test_visibility():\n@@ -588,3 +589,37 @@ def test_svg_font_string(font_str, include_generic):\n \n         assert font_info == f\"{size}px {font_str}\"\n     assert text_count == len(ax.texts)\n+\n+\n+def test_annotationbbox_gid():\n+    # Test that object gid appears in the AnnotationBbox\n+    # in output svg.\n+    fig = plt.figure()\n+    ax = fig.add_subplot()\n+    arr_img = np.ones((32, 32))\n+    xy = (0.3, 0.55)\n+\n+    imagebox = OffsetImage(arr_img, zoom=0.1)\n+    imagebox.image.axes = ax\n+\n+    ab = AnnotationBbox(imagebox, xy,\n+                        xybox=(120., -80.),\n+                        xycoords='data',\n+                        boxcoords=\"offset points\",\n+                        pad=0.5,\n+                        arrowprops=dict(\n+                            arrowstyle=\"->\",\n+                            connectionstyle=\"angle,angleA=0,angleB=90,rad=3\")\n+                        )\n+    ab.set_gid(\"a test for issue 20044\")\n+    ax.add_artist(ab)\n+    fig.canvas.draw()\n+\n+    fd = BytesIO()\n+    fig.savefig(fd, format='svg')\n+    fd.seek(0)\n+    buf = fd.read().decode()\n+    fd.close()\n+\n+    expected = '<g id=\"a test for issue 20044\">'\n+    assert expected in buf\n\nFrom e22733427ac2133bf5c03eb4114ca73eb218e8e7 Mon Sep 17 00:00:00 2001\nFrom: saranti <tsarantis@proton.me>\nDate: Sun, 18 Dec 2022 03:12:42 +1100\nSubject: [PATCH 3/4] Use a context manager\n\n---\n lib/matplotlib/tests/test_backend_svg.py | 8 +++-----\n 1 file changed, 3 insertions(+), 5 deletions(-)\n\ndiff --git a/lib/matplotlib/tests/test_backend_svg.py b/lib/matplotlib/tests/test_backend_svg.py\nindex 454dcc27ff76..bb42290c5d8e 100644\n--- a/lib/matplotlib/tests/test_backend_svg.py\n+++ b/lib/matplotlib/tests/test_backend_svg.py\n@@ -615,11 +615,9 @@ def test_annotationbbox_gid():\n     ax.add_artist(ab)\n     fig.canvas.draw()\n \n-    fd = BytesIO()\n-    fig.savefig(fd, format='svg')\n-    fd.seek(0)\n-    buf = fd.read().decode()\n-    fd.close()\n+    with BytesIO() as fd:\n+        fig.savefig(fd, format='svg')\n+        buf = fd.getvalue().decode('utf-8')\n \n     expected = '<g id=\"a test for issue 20044\">'\n     assert expected in buf\n\nFrom a09f78aea02d345da6467992a601331cfdb1a9f0 Mon Sep 17 00:00:00 2001\nFrom: saranti <tsarantis@proton.me>\nDate: Thu, 22 Dec 2022 18:33:54 +1100\nSubject: [PATCH 4/4] Remove line\n\n---\n lib/matplotlib/tests/test_backend_svg.py | 1 -\n 1 file changed, 1 deletion(-)\n\ndiff --git a/lib/matplotlib/tests/test_backend_svg.py b/lib/matplotlib/tests/test_backend_svg.py\nindex bb42290c5d8e..c0fe8549c2f3 100644\n--- a/lib/matplotlib/tests/test_backend_svg.py\n+++ b/lib/matplotlib/tests/test_backend_svg.py\n@@ -613,7 +613,6 @@ def test_annotationbbox_gid():\n                         )\n     ab.set_gid(\"a test for issue 20044\")\n     ax.add_artist(ab)\n-    fig.canvas.draw()\n \n     with BytesIO() as fd:\n         fig.savefig(fd, format='svg')\n", "gold_standard_pr_link": "https://github.com/matplotlib/matplotlib/pull/24637"}