{"instance_id": "pytest-dev__pytest-7432", "score": "I", "diff": "diff --git a/src/_pytest/skipping.py b/src/_pytest/skipping.py\nindex 7bd975e5a..b7cfe8144 100644\n--- a/src/_pytest/skipping.py\n+++ b/src/_pytest/skipping.py\n@@ -292,7 +292,8 @@ def pytest_runtest_makereport(item: Item, call: CallInfo[None]):\n                 rep.outcome = \"passed\"\n                 rep.wasxfail = xfailed.reason\n     elif (\n-        item._store.get(skipped_by_mark_key, True)\n+        not item.config.option.runxfail\n+        and item._store.get(skipped_by_mark_key, True)\n         and rep.skipped\n         and type(rep.longrepr) is tuple\n     ):\n", "gold_standard_diff": "From 1e432aa09392eb1686f1947671e87d5bd6f6f5f4 Mon Sep 17 00:00:00 2001\nFrom: Arvin Firouzi <427014@student.fontys.nl>\nDate: Mon, 29 Jun 2020 23:49:02 +0200\nSubject: [PATCH 1/6] Fix issue 7392\n\n---\n src/_pytest/skipping.py | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/src/_pytest/skipping.py b/src/_pytest/skipping.py\nindex 7bd975e5a09..058bf2a3824 100644\n--- a/src/_pytest/skipping.py\n+++ b/src/_pytest/skipping.py\n@@ -270,7 +270,7 @@ def pytest_runtest_makereport(item: Item, call: CallInfo[None]):\n         else:\n             rep.longrepr = \"Unexpected success\"\n         rep.outcome = \"failed\"\n-    elif item.config.option.runxfail:\n+    elif item.config.option.runxfail and xfailed:\n         pass  # don't interfere\n     elif call.excinfo and isinstance(call.excinfo.value, xfail.Exception):\n         assert call.excinfo.value.msg is not None\n\nFrom ec6936cbb8e8c8e761e0607cc83d1be95b07fe56 Mon Sep 17 00:00:00 2001\nFrom: Arvin Firouzi <427014@student.fontys.nl>\nDate: Tue, 30 Jun 2020 13:09:47 +0200\nSubject: [PATCH 2/6] add changelog and test\n\n---\n changelog/7392.bugfix.rst |  1 +\n testing/test_skipping.py  | 14 ++++++++++++++\n 2 files changed, 15 insertions(+)\n create mode 100644 changelog/7392.bugfix.rst\n\ndiff --git a/changelog/7392.bugfix.rst b/changelog/7392.bugfix.rst\nnew file mode 100644\nindex 00000000000..e346cf196a2\n--- /dev/null\n+++ b/changelog/7392.bugfix.rst\n@@ -0,0 +1 @@\n+Fix the issue not ignoring --runxfail when using skip mark in a test.\ndiff --git a/testing/test_skipping.py b/testing/test_skipping.py\nindex 0b1c0b49b03..a851e0f41bf 100644\n--- a/testing/test_skipping.py\n+++ b/testing/test_skipping.py\n@@ -235,6 +235,20 @@ def test_func2():\n             [\"*def test_func():*\", \"*assert 0*\", \"*1 failed*1 pass*\"]\n         )\n \n+    def test_xfail_run_with_skip_mark(self, testdir):\n+        p = testdir.makepyfile(\n+            \"\"\"\n+            import pytest\n+            @pytest.mark.skip\n+            def test_skip_location() -> None:\n+                assert 0\n+        \"\"\"\n+        )\n+        result = testdir.runpytest(p, \"-rs\")\n+        result.stdout.fnmatch_lines([\"*unconditional skip*\", \"*1 skipped*\"])\n+        result = testdir.runpytest(p, \"-rs --runxfail\")\n+        result.stdout.fnmatch_lines([\"*unconditional skip*\", \"*1 skipped*\"])\n+\n     def test_xfail_evalfalse_but_fails(self, testdir):\n         item = testdir.getitem(\n             \"\"\"\n\nFrom a54ef1d5492b877d761c36604a51a173a458df46 Mon Sep 17 00:00:00 2001\nFrom: Arvin Firouzi <427014@student.fontys.nl>\nDate: Tue, 30 Jun 2020 23:38:07 +0200\nSubject: [PATCH 3/6] parametrize test\n\n---\n testing/test_skipping.py | 15 ++++++++++-----\n 1 file changed, 10 insertions(+), 5 deletions(-)\n\ndiff --git a/testing/test_skipping.py b/testing/test_skipping.py\nindex a851e0f41bf..887e6a4ef7c 100644\n--- a/testing/test_skipping.py\n+++ b/testing/test_skipping.py\n@@ -235,7 +235,14 @@ def test_func2():\n             [\"*def test_func():*\", \"*assert 0*\", \"*1 failed*1 pass*\"]\n         )\n \n-    def test_xfail_run_with_skip_mark(self, testdir):\n+    @pytest.mark.parametrize(\n+        \"test_input,expected\",\n+        [\n+            (\"-rs\", [\"*unconditional skip*\", \"*1 skipped*\"]),\n+            (\"-rs --runxfail\", [\"*unconditional skip*\", \"*1 skipped*\"]),\n+        ],\n+    )\n+    def test_xfail_run_with_skip_mark(self, testdir, test_input, expected):\n         p = testdir.makepyfile(\n             \"\"\"\n             import pytest\n@@ -244,10 +251,8 @@ def test_skip_location() -> None:\n                 assert 0\n         \"\"\"\n         )\n-        result = testdir.runpytest(p, \"-rs\")\n-        result.stdout.fnmatch_lines([\"*unconditional skip*\", \"*1 skipped*\"])\n-        result = testdir.runpytest(p, \"-rs --runxfail\")\n-        result.stdout.fnmatch_lines([\"*unconditional skip*\", \"*1 skipped*\"])\n+        result = testdir.runpytest(p, test_input)\n+        result.stdout.fnmatch_lines(expected)\n \n     def test_xfail_evalfalse_but_fails(self, testdir):\n         item = testdir.getitem(\n\nFrom 5af4f6ff97d2560bbf34a01f3f01b002c302d3a6 Mon Sep 17 00:00:00 2001\nFrom: Arvin Firouzi <427014@student.fontys.nl>\nDate: Wed, 1 Jul 2020 14:32:43 +0200\nSubject: [PATCH 4/6] change the code to fix the main problem\n\n---\n src/_pytest/skipping.py | 4 ++--\n 1 file changed, 2 insertions(+), 2 deletions(-)\n\ndiff --git a/src/_pytest/skipping.py b/src/_pytest/skipping.py\nindex 058bf2a3824..c9bdfee89e2 100644\n--- a/src/_pytest/skipping.py\n+++ b/src/_pytest/skipping.py\n@@ -270,7 +270,7 @@ def pytest_runtest_makereport(item: Item, call: CallInfo[None]):\n         else:\n             rep.longrepr = \"Unexpected success\"\n         rep.outcome = \"failed\"\n-    elif item.config.option.runxfail and xfailed:\n+    elif item.config.option.runxfail:\n         pass  # don't interfere\n     elif call.excinfo and isinstance(call.excinfo.value, xfail.Exception):\n         assert call.excinfo.value.msg is not None\n@@ -291,7 +291,7 @@ def pytest_runtest_makereport(item: Item, call: CallInfo[None]):\n             else:\n                 rep.outcome = \"passed\"\n                 rep.wasxfail = xfailed.reason\n-    elif (\n+    if (\n         item._store.get(skipped_by_mark_key, True)\n         and rep.skipped\n         and type(rep.longrepr) is tuple\n\nFrom de62197cd8150ea2cc3a2499f995f44ca51b293a Mon Sep 17 00:00:00 2001\nFrom: Arvin Firouzi <427014@student.fontys.nl>\nDate: Thu, 9 Jul 2020 20:38:06 +0200\nSubject: [PATCH 5/6] fix test and main problem\n\n---\n changelog/7392.bugfix.rst |  2 +-\n src/_pytest/skipping.py   |  1 +\n testing/test_skipping.py  | 12 ++++++------\n 3 files changed, 8 insertions(+), 7 deletions(-)\n\ndiff --git a/changelog/7392.bugfix.rst b/changelog/7392.bugfix.rst\nindex e346cf196a2..48cd949faef 100644\n--- a/changelog/7392.bugfix.rst\n+++ b/changelog/7392.bugfix.rst\n@@ -1 +1 @@\n-Fix the issue not ignoring --runxfail when using skip mark in a test.\n+Fix the reported location of tests skipped with ``@pytest.mark.skip`` when ``--runxfail`` is used.\ndiff --git a/src/_pytest/skipping.py b/src/_pytest/skipping.py\nindex c9bdfee89e2..591a65df922 100644\n--- a/src/_pytest/skipping.py\n+++ b/src/_pytest/skipping.py\n@@ -291,6 +291,7 @@ def pytest_runtest_makereport(item: Item, call: CallInfo[None]):\n             else:\n                 rep.outcome = \"passed\"\n                 rep.wasxfail = xfailed.reason\n+\n     if (\n         item._store.get(skipped_by_mark_key, True)\n         and rep.skipped\ndiff --git a/testing/test_skipping.py b/testing/test_skipping.py\nindex 887e6a4ef7c..931027ce059 100644\n--- a/testing/test_skipping.py\n+++ b/testing/test_skipping.py\n@@ -236,22 +236,22 @@ def test_func2():\n         )\n \n     @pytest.mark.parametrize(\n-        \"test_input,expected\",\n+       \"test_input,expected\",\n         [\n-            (\"-rs\", [\"*unconditional skip*\", \"*1 skipped*\"]),\n-            (\"-rs --runxfail\", [\"*unconditional skip*\", \"*1 skipped*\"]),\n+            ([\"-rs\"], [\"SKIPPED [1] test_sample.py:2: unconditional skip\", \"*1 skipped*\"]),\n+            ([\"-rs\", \"--runxfail\"], [\"SKIPPED [1] test_sample.py:2: unconditional skip\", \"*1 skipped*\"]),\n         ],\n     )\n     def test_xfail_run_with_skip_mark(self, testdir, test_input, expected):\n-        p = testdir.makepyfile(\n-            \"\"\"\n+        testdir.makepyfile(\n+            test_sample=\"\"\"\n             import pytest\n             @pytest.mark.skip\n             def test_skip_location() -> None:\n                 assert 0\n         \"\"\"\n         )\n-        result = testdir.runpytest(p, test_input)\n+        result = testdir.runpytest(*test_input)\n         result.stdout.fnmatch_lines(expected)\n \n     def test_xfail_evalfalse_but_fails(self, testdir):\n\nFrom ad688f0d1c06d59303750975749b1c53907413c4 Mon Sep 17 00:00:00 2001\nFrom: Arvin Firouzi <427014@student.fontys.nl>\nDate: Thu, 9 Jul 2020 20:52:51 +0200\nSubject: [PATCH 6/6] fix linting in test_skipping.py\n\n---\n testing/test_skipping.py | 12 +++++++++---\n 1 file changed, 9 insertions(+), 3 deletions(-)\n\ndiff --git a/testing/test_skipping.py b/testing/test_skipping.py\nindex 931027ce059..8fceb37aa71 100644\n--- a/testing/test_skipping.py\n+++ b/testing/test_skipping.py\n@@ -236,10 +236,16 @@ def test_func2():\n         )\n \n     @pytest.mark.parametrize(\n-       \"test_input,expected\",\n+        \"test_input,expected\",\n         [\n-            ([\"-rs\"], [\"SKIPPED [1] test_sample.py:2: unconditional skip\", \"*1 skipped*\"]),\n-            ([\"-rs\", \"--runxfail\"], [\"SKIPPED [1] test_sample.py:2: unconditional skip\", \"*1 skipped*\"]),\n+            (\n+                [\"-rs\"],\n+                [\"SKIPPED [1] test_sample.py:2: unconditional skip\", \"*1 skipped*\"],\n+            ),\n+            (\n+                [\"-rs\", \"--runxfail\"],\n+                [\"SKIPPED [1] test_sample.py:2: unconditional skip\", \"*1 skipped*\"],\n+            ),\n         ],\n     )\n     def test_xfail_run_with_skip_mark(self, testdir, test_input, expected):\n", "gold_standard_pr_link": "https://github.com/pytest-dev/pytest/pull/7432"}