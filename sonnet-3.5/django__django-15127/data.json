{"instance_id": "django__django-15127", "score": "I", "diff": "diff --git a/django/contrib/messages/storage/base.py b/django/contrib/messages/storage/base.py\nindex 01422066a6..870f9bc309 100644\n--- a/django/contrib/messages/storage/base.py\n+++ b/django/contrib/messages/storage/base.py\n@@ -1,8 +1,6 @@\n from django.conf import settings\n from django.contrib.messages import constants, utils\n \n-LEVEL_TAGS = utils.get_level_tags()\n-\n \n class Message:\n     \"\"\"\n@@ -38,7 +36,8 @@ class Message:\n \n     @property\n     def level_tag(self):\n-        return LEVEL_TAGS.get(self.level, '')\n+        from django.contrib.messages import utils\n+        return utils.get_level_tags().get(self.level, '')\n \n \n class BaseStorage:\n", "gold_standard_diff": "From 24b316536a7ee4c54a54f632de1852aecb4038c0 Mon Sep 17 00:00:00 2001\nFrom: Hasan Ramezani <hasan.r67@gmail.com>\nDate: Thu, 25 Nov 2021 14:13:16 +0100\nSubject: [PATCH] Fixed #33303 -- Changed messages' level tags on MESSAGE_TAGS\n setting change.\n\n---\n django/contrib/messages/apps.py | 11 +++++++++++\n tests/messages_tests/base.py    | 22 ++++------------------\n tests/messages_tests/tests.py   | 18 +++++++++++++++++-\n 3 files changed, 32 insertions(+), 19 deletions(-)\n\ndiff --git a/django/contrib/messages/apps.py b/django/contrib/messages/apps.py\nindex 0ff25d38851d..064b9a4bde8f 100644\n--- a/django/contrib/messages/apps.py\n+++ b/django/contrib/messages/apps.py\n@@ -1,7 +1,18 @@\n from django.apps import AppConfig\n+from django.contrib.messages.storage import base\n+from django.contrib.messages.utils import get_level_tags\n+from django.test.signals import setting_changed\n from django.utils.translation import gettext_lazy as _\n \n \n+def update_level_tags(setting, **kwargs):\n+    if setting == 'MESSAGE_TAGS':\n+        base.LEVEL_TAGS = get_level_tags()\n+\n+\n class MessagesConfig(AppConfig):\n     name = 'django.contrib.messages'\n     verbose_name = _(\"Messages\")\n+\n+    def ready(self):\n+        setting_changed.connect(update_level_tags)\ndiff --git a/tests/messages_tests/base.py b/tests/messages_tests/base.py\nindex 9dad08e6c79b..2ee1f995aa15 100644\n--- a/tests/messages_tests/base.py\n+++ b/tests/messages_tests/base.py\n@@ -1,7 +1,7 @@\n-from django.contrib.messages import constants, get_level, set_level, utils\n+from django.contrib.messages import constants, get_level, set_level\n from django.contrib.messages.api import MessageFailure\n from django.contrib.messages.constants import DEFAULT_LEVELS\n-from django.contrib.messages.storage import base, default_storage\n+from django.contrib.messages.storage import default_storage\n from django.contrib.messages.storage.base import Message\n from django.http import HttpRequest, HttpResponse\n from django.test import modify_settings, override_settings\n@@ -22,20 +22,6 @@ def add_level_messages(storage):\n     storage.add(constants.SUCCESS, 'This was a triumph.')\n \n \n-class override_settings_tags(override_settings):\n-    def enable(self):\n-        super().enable()\n-        # LEVEL_TAGS is a constant defined in the\n-        # django.contrib.messages.storage.base module, so after changing\n-        # settings.MESSAGE_TAGS, update that constant also.\n-        self.old_level_tags = base.LEVEL_TAGS\n-        base.LEVEL_TAGS = utils.get_level_tags()\n-\n-    def disable(self):\n-        super().disable()\n-        base.LEVEL_TAGS = self.old_level_tags\n-\n-\n class BaseTests:\n     storage_class = default_storage\n     levels = {\n@@ -47,7 +33,7 @@ class BaseTests:\n     }\n \n     def setUp(self):\n-        self.settings_override = override_settings_tags(\n+        self.settings_override = override_settings(\n             TEMPLATES=[{\n                 'BACKEND': 'django.template.backends.django.DjangoTemplates',\n                 'DIRS': [],\n@@ -368,7 +354,7 @@ def test_level_tag(self):\n         tags = [msg.level_tag for msg in storage]\n         self.assertEqual(tags, ['info', '', 'debug', 'warning', 'error', 'success'])\n \n-    @override_settings_tags(MESSAGE_TAGS={\n+    @override_settings(MESSAGE_TAGS={\n         constants.INFO: 'info',\n         constants.DEBUG: '',\n         constants.WARNING: '',\ndiff --git a/tests/messages_tests/tests.py b/tests/messages_tests/tests.py\nindex eea07c9c41f1..aebb5bb0ec4b 100644\n--- a/tests/messages_tests/tests.py\n+++ b/tests/messages_tests/tests.py\n@@ -1,8 +1,9 @@\n from unittest import mock\n \n from django.contrib.messages import constants\n+from django.contrib.messages.storage import base\n from django.contrib.messages.storage.base import Message\n-from django.test import SimpleTestCase\n+from django.test import SimpleTestCase, override_settings\n \n \n class MessageTests(SimpleTestCase):\n@@ -15,3 +16,18 @@ def test_eq(self):\n         self.assertNotEqual(msg_1, msg_2)\n         self.assertNotEqual(msg_1, msg_3)\n         self.assertNotEqual(msg_2, msg_3)\n+\n+\n+class TestLevelTags(SimpleTestCase):\n+    message_tags = {\n+        constants.INFO: 'info',\n+        constants.DEBUG: '',\n+        constants.WARNING: '',\n+        constants.ERROR: 'bad',\n+        constants.SUCCESS: '',\n+        12: 'custom',\n+    }\n+\n+    @override_settings(MESSAGE_TAGS=message_tags)\n+    def test_override_settings_level_tags(self):\n+        self.assertEqual(base.LEVEL_TAGS, self.message_tags)\n", "gold_standard_pr_link": "https://github.com/django/django/pull/15127"}