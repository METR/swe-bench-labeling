{"instance_id": "sphinx-doc__sphinx-10466", "score": "C", "diff": "diff --git a/sphinx/builders/gettext.py b/sphinx/builders/gettext.py\nindex e8bc547b7..034b582e2 100644\n--- a/sphinx/builders/gettext.py\n+++ b/sphinx/builders/gettext.py\n@@ -32,9 +32,12 @@ class Message:\n     \"\"\"An entry of translatable message.\"\"\"\n     def __init__(self, text: str, locations: List[Tuple[str, int]], uuids: List[str]):\n         self.text = text\n-        self.locations = locations\n+        self.locations = self.uniqueLocation(locations)\n         self.uuids = uuids\n \n+    def uniqueLocation(self, locations: List[Tuple[str, int]]) -> List[Tuple[str, int]]:\n+        return list(dict.fromkeys(locations))\n+\n \n class Catalog:\n     \"\"\"Catalog of translatable messages.\"\"\"\ndiff --git a/tox.ini b/tox.ini\nindex 105a02597..90ada0821 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -29,7 +29,7 @@ setenv =\n     PYTHONWARNINGS = all\n     PYTEST_ADDOPTS = {env:PYTEST_ADDOPTS:} --color yes\n commands=\n-    python -X dev -X warn_default_encoding -m pytest --durations 25 {posargs}\n+    python -X dev -X warn_default_encoding -m pytest -rA --durations 25 {posargs}\n \n [testenv:du-latest]\n commands =\n", "gold_standard_diff": "From 51c84e041f8e581eb04a041fb410341d152deafb Mon Sep 17 00:00:00 2001\nFrom: Takeshi KOMIYA <i.tkomiya@gmail.com>\nDate: Mon, 23 May 2022 00:37:45 +0900\nSubject: [PATCH] Fix #10104: gettext: Duplicated locations are output to pot\n file\n\nWhen 3rd party extension does not provide line number for each message,\nduplicated locations are output to pot file unexpectedly.  This filters\nduplicated locations before generationg pot file.\n---\n CHANGES                     |  2 ++\n sphinx/builders/gettext.py  |  3 ++-\n tests/test_build_gettext.py | 20 ++++++++++++++++++++\n 3 files changed, 24 insertions(+), 1 deletion(-)\n\ndiff --git a/CHANGES b/CHANGES\nindex ed47709e539..69e6fdd097a 100644\n--- a/CHANGES\n+++ b/CHANGES\n@@ -21,6 +21,8 @@ Bugs fixed\n * #9648: autodoc: ``*args`` and ``**kwargs`` entries are duplicated when\n   ``autodoc_typehints=\"description\"``\n * #10443: epub: EPUB builder can't detect the mimetype of .webp file\n+* #10104: gettext: Duplicated locations are shown if 3rd party extension does\n+  not provide correct information\n * #10456: py domain: ``:meta:`` fields are displayed if docstring contains two\n   or more meta-field\n * #9096: sphinx-build: the value of progress bar for paralle build is wrong\ndiff --git a/sphinx/builders/gettext.py b/sphinx/builders/gettext.py\nindex e8bc547b77f..0d7d0ac11d8 100644\n--- a/sphinx/builders/gettext.py\n+++ b/sphinx/builders/gettext.py\n@@ -57,7 +57,8 @@ def add(self, msg: str, origin: Union[Element, \"MsgOrigin\"]) -> None:\n \n     def __iter__(self) -> Generator[Message, None, None]:\n         for message in self.messages:\n-            positions = [(source, line) for source, line, uuid in self.metadata[message]]\n+            positions = sorted(set((source, line) for source, line, uuid\n+                                   in self.metadata[message]))\n             uuids = [uuid for source, line, uuid in self.metadata[message]]\n             yield Message(message, positions, uuids)\n \ndiff --git a/tests/test_build_gettext.py b/tests/test_build_gettext.py\nindex 3c4617e849c..cca6fab929b 100644\n--- a/tests/test_build_gettext.py\n+++ b/tests/test_build_gettext.py\n@@ -8,9 +8,29 @@\n \n import pytest\n \n+from sphinx.builders.gettext import Catalog, MsgOrigin\n from sphinx.util.osutil import cd\n \n \n+def test_Catalog_duplicated_message():\n+    catalog = Catalog()\n+    catalog.add('hello', MsgOrigin('/path/to/filename', 1))\n+    catalog.add('hello', MsgOrigin('/path/to/filename', 1))\n+    catalog.add('hello', MsgOrigin('/path/to/filename', 2))\n+    catalog.add('hello', MsgOrigin('/path/to/yetanother', 1))\n+    catalog.add('world', MsgOrigin('/path/to/filename', 1))\n+\n+    assert len(list(catalog)) == 2\n+\n+    msg1, msg2 = list(catalog)\n+    assert msg1.text == 'hello'\n+    assert msg1.locations == [('/path/to/filename', 1),\n+                              ('/path/to/filename', 2),\n+                              ('/path/to/yetanother', 1)]\n+    assert msg2.text == 'world'\n+    assert msg2.locations == [('/path/to/filename', 1)]\n+\n+\n @pytest.mark.sphinx('gettext', srcdir='root-gettext')\n def test_build_gettext(app):\n     # Generic build; should fail only when the builder is horribly broken.\n", "gold_standard_pr_link": "https://github.com/sphinx-doc/sphinx/pull/10466"}