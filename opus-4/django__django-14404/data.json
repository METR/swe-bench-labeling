{"instance_id": "django__django-14404", "score": "I", "diff": "diff --git a/django/contrib/admin/sites.py b/django/contrib/admin/sites.py\nindex 59a4a0364d..74ef4c491e 100644\n--- a/django/contrib/admin/sites.py\n+++ b/django/contrib/admin/sites.py\n@@ -420,7 +420,7 @@ class AdminSite:\n     def catch_all_view(self, request, url):\n         if settings.APPEND_SLASH and not url.endswith('/'):\n             urlconf = getattr(request, 'urlconf', None)\n-            path = '%s/' % request.path_info\n+            path = '%s/' % request.path\n             try:\n                 match = resolve(path, urlconf)\n             except Resolver404:\n", "gold_standard_diff": "From f7691d4812c578e696635718e67639d2e08eac40 Mon Sep 17 00:00:00 2001\nFrom: Slava Skvortsov <kondor1995@mail.ru>\nDate: Mon, 17 May 2021 13:21:50 +0200\nSubject: [PATCH] Fixed #32754 -- Made AdminSite.catch_all_view() respect\n SCRIPT_NAME.\n\nRegression in ba31b0103442ac891fb3cb98f316781254e366c3.\n---\n django/contrib/admin/sites.py |  5 ++---\n docs/releases/3.2.4.txt       |  4 +++-\n tests/admin_views/tests.py    | 36 +++++++++++++++++++++++++++++++++++\n 3 files changed, 41 insertions(+), 4 deletions(-)\n\ndiff --git a/django/contrib/admin/sites.py b/django/contrib/admin/sites.py\nindex 59a4a0364d43..62c5c8a782f3 100644\n--- a/django/contrib/admin/sites.py\n+++ b/django/contrib/admin/sites.py\n@@ -420,14 +420,13 @@ def autocomplete_view(self, request):\n     def catch_all_view(self, request, url):\n         if settings.APPEND_SLASH and not url.endswith('/'):\n             urlconf = getattr(request, 'urlconf', None)\n-            path = '%s/' % request.path_info\n             try:\n-                match = resolve(path, urlconf)\n+                match = resolve('%s/' % request.path_info, urlconf)\n             except Resolver404:\n                 pass\n             else:\n                 if getattr(match.func, 'should_append_slash', True):\n-                    return HttpResponsePermanentRedirect(path)\n+                    return HttpResponsePermanentRedirect('%s/' % request.path)\n         raise Http404\n \n     def _build_app_dict(self, request, label=None):\ndiff --git a/docs/releases/3.2.4.txt b/docs/releases/3.2.4.txt\nindex 4ff28f9d72ff..51a489816362 100644\n--- a/docs/releases/3.2.4.txt\n+++ b/docs/releases/3.2.4.txt\n@@ -9,4 +9,6 @@ Django 3.2.4 fixes several bugs in 3.2.3.\n Bugfixes\n ========\n \n-* ...\n+* Fixed a bug in Django 3.2 where a final catch-all view in the admin didn't\n+  respect the server-provided value of ``SCRIPT_NAME`` when redirecting\n+  unauthenticated users to the login page (:ticket:`32754`).\ndiff --git a/tests/admin_views/tests.py b/tests/admin_views/tests.py\nindex b1658941ee6d..69fd43ba8f4d 100644\n--- a/tests/admin_views/tests.py\n+++ b/tests/admin_views/tests.py\n@@ -6602,6 +6602,42 @@ def test_missing_slash_append_slash_true(self):\n         response = self.client.get(known_url[:-1])\n         self.assertRedirects(response, known_url, status_code=301, target_status_code=403)\n \n+    @override_settings(APPEND_SLASH=True)\n+    def test_missing_slash_append_slash_true_script_name(self):\n+        superuser = User.objects.create_user(\n+            username='staff',\n+            password='secret',\n+            email='staff@example.com',\n+            is_staff=True,\n+        )\n+        self.client.force_login(superuser)\n+        known_url = reverse('admin:admin_views_article_changelist')\n+        response = self.client.get(known_url[:-1], SCRIPT_NAME='/prefix/')\n+        self.assertRedirects(\n+            response,\n+            '/prefix' + known_url,\n+            status_code=301,\n+            fetch_redirect_response=False,\n+        )\n+\n+    @override_settings(APPEND_SLASH=True, FORCE_SCRIPT_NAME='/prefix/')\n+    def test_missing_slash_append_slash_true_force_script_name(self):\n+        superuser = User.objects.create_user(\n+            username='staff',\n+            password='secret',\n+            email='staff@example.com',\n+            is_staff=True,\n+        )\n+        self.client.force_login(superuser)\n+        known_url = reverse('admin:admin_views_article_changelist')\n+        response = self.client.get(known_url[:-1])\n+        self.assertRedirects(\n+            response,\n+            '/prefix' + known_url,\n+            status_code=301,\n+            fetch_redirect_response=False,\n+        )\n+\n     @override_settings(APPEND_SLASH=True)\n     def test_missing_slash_append_slash_true_non_staff_user(self):\n         user = User.objects.create_user(\n", "gold_standard_pr_link": "https://github.com/django/django/pull/14404"}