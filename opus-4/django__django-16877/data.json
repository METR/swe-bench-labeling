{"instance_id": "django__django-16877", "score": "I", "diff": "diff --git a/django/template/defaultfilters.py b/django/template/defaultfilters.py\nindex 5289ef34a0..672a8f5946 100644\n--- a/django/template/defaultfilters.py\n+++ b/django/template/defaultfilters.py\n@@ -498,6 +498,16 @@ def safeseq(value):\n     return [mark_safe(obj) for obj in value]\n \n \n+@register.filter(is_safe=True)\n+def escapeseq(value):\n+    \"\"\"\n+    An \"escape\" filter for sequences. Escape each element in the sequence,\n+    individually, after converting them to strings. Return a list\n+    with the results.\n+    \"\"\"\n+    return [conditional_escape(obj) for obj in value]\n+\n+\n @register.filter(is_safe=True)\n @stringfilter\n def striptags(value):\ndiff --git a/docs/ref/templates/builtins.txt b/docs/ref/templates/builtins.txt\nindex 3aa20dfc71..989a53308c 100644\n--- a/docs/ref/templates/builtins.txt\n+++ b/docs/ref/templates/builtins.txt\n@@ -1849,6 +1849,32 @@ For example:\n If ``value`` is ``\"testing\\r\\njavascript 'string\\\" <b>escaping</b>\"``,\n the output will be ``\"testing\\\\u000D\\\\u000Ajavascript \\\\u0027string\\\\u0022 \\\\u003Cb\\\\u003Eescaping\\\\u003C/b\\\\u003E\"``.\n \n+.. templatefilter:: escapeseq\n+\n+``escapeseq``\n+-------------\n+\n+Applies the :tfilter:`escape` filter to each element of a sequence. Useful in\n+conjunction with other filters that operate on sequences, such as\n+:tfilter:`join`. For example:\n+\n+.. code-block:: html+django\n+\n+    {{ some_list|escapeseq|join:\", \" }}\n+\n+This is particularly useful when you need to escape each element in a list\n+before joining them, especially in contexts where autoescape is off:\n+\n+.. code-block:: html+django\n+\n+    {% autoescape off %}\n+        {{ some_list|escapeseq|join:\", \" }}\n+    {% endautoescape %}\n+\n+You couldn't use the :tfilter:`escape` filter directly in this case, as it would\n+first convert the variable into a string, rather than working with the\n+individual elements of the sequence.\n+\n .. templatefilter:: filesizeformat\n \n ``filesizeformat``\ndiff --git a/tests/template_tests/filter_tests/test_escapeseq.py b/tests/template_tests/filter_tests/test_escapeseq.py\nnew file mode 100644\nindex 0000000000..e5d2480dd6\n--- /dev/null\n+++ b/tests/template_tests/filter_tests/test_escapeseq.py\n@@ -0,0 +1,44 @@\n+from django.test import SimpleTestCase\n+\n+from ..utils import setup\n+\n+\n+class EscapeseqTests(SimpleTestCase):\n+    @setup({\"escapeseq01\": '{{ a|join:\", \" }} -- {{ a|escapeseq|join:\", \" }}'})\n+    def test_escapeseq01(self):\n+        \"\"\"Test that escapeseq escapes each element when autoescape is on.\"\"\"\n+        output = self.engine.render_to_string(\"escapeseq01\", {\"a\": [\"&\", \"<\", \">\", '\"']})\n+        self.assertEqual(output, \"&amp;, &lt;, &gt;, &quot; -- &amp;, &lt;, &gt;, &quot;\")\n+\n+    @setup(\n+        {\n+            \"escapeseq02\": (\n+                '{% autoescape off %}{{ a|join:\", \" }} -- {{ a|escapeseq|join:\", \" }}'\n+                \"{% endautoescape %}\"\n+            )\n+        }\n+    )\n+    def test_escapeseq02(self):\n+        \"\"\"Test that escapeseq escapes each element even when autoescape is off.\"\"\"\n+        output = self.engine.render_to_string(\"escapeseq02\", {\"a\": [\"&\", \"<\", \">\", '\"']})\n+        self.assertEqual(output, \"&, <, >, \\\" -- &amp;, &lt;, &gt;, &quot;\")\n+\n+    @setup({\"escapeseq03\": \"{% autoescape off %}{{ a|escapeseq|join:', ' }}{% endautoescape %}\"})\n+    def test_escapeseq03(self):\n+        \"\"\"Test that escapeseq output works with join when autoescape is off.\"\"\"\n+        output = self.engine.render_to_string(\"escapeseq03\", {\"a\": [\"&\", \"<\", \">\", '\"']})\n+        self.assertEqual(output, \"&amp;, &lt;, &gt;, &quot;\")\n+\n+    @setup({\"escapeseq04\": \"{{ a|escapeseq|join:', ' }}\"})\n+    def test_escapeseq04(self):\n+        \"\"\"Test escapeseq with various data types.\"\"\"\n+        output = self.engine.render_to_string(\"escapeseq04\", {\"a\": [1, 2.5, \"test<>\", None]})\n+        self.assertEqual(output, \"1, 2.5, test&lt;&gt;, None\")\n+\n+    @setup({\"escapeseq05\": \"{{ a|escapeseq }}\"})\n+    def test_escapeseq05(self):\n+        \"\"\"Test that escapeseq returns a list.\"\"\"\n+        output = self.engine.render_to_string(\"escapeseq05\", {\"a\": [\"<b>\", \"</b>\"]})\n+        # The list gets converted to string representation when rendered directly\n+        # and the output itself gets escaped because it contains quotes\n+        self.assertEqual(output, \"[&#x27;&amp;lt;b&amp;gt;&#x27;, &#x27;&amp;lt;/b&amp;gt;&#x27;]\")\n", "gold_standard_diff": "diff --git a/AUTHORS b/AUTHORS\nindex 2e3a91c7569f..95f24762ee3d 100644\n--- a/AUTHORS\n+++ b/AUTHORS\n@@ -108,6 +108,7 @@ answer newbie questions, and generally made Django that much better:\n     Arthur <avandorp@gmail.com>\n     Arthur Jovart <arthur@jovart.com>\n     Arthur Koziel <http://arthurkoziel.com>\n+    Arthur Moreira <moreirarthur96@gmail.com>\n     Arthur Rio <arthur.rio44@gmail.com>\n     Arvis Bickovskis <viestards.lists@gmail.com>\n     Arya Khaligh <bartararya@gmail.com>\ndiff --git a/django/template/defaultfilters.py b/django/template/defaultfilters.py\nindex 5289ef34a0be..589ca3841423 100644\n--- a/django/template/defaultfilters.py\n+++ b/django/template/defaultfilters.py\n@@ -444,6 +444,16 @@ def escape_filter(value):\n     return conditional_escape(value)\n \n \n+@register.filter(is_safe=True)\n+def escapeseq(value):\n+    \"\"\"\n+    An \"escape\" filter for sequences. Mark each element in the sequence,\n+    individually, as a string that should be auto-escaped. Return a list with\n+    the results.\n+    \"\"\"\n+    return [conditional_escape(obj) for obj in value]\n+\n+\n @register.filter(is_safe=True)\n @stringfilter\n def force_escape(value):\ndiff --git a/docs/ref/templates/builtins.txt b/docs/ref/templates/builtins.txt\nindex 3aa20dfc716e..695357c5a0d0 100644\n--- a/docs/ref/templates/builtins.txt\n+++ b/docs/ref/templates/builtins.txt\n@@ -1831,6 +1831,8 @@ For example, you can apply ``escape`` to fields when :ttag:`autoescape` is off:\n         {{ title|escape }}\n     {% endautoescape %}\n \n+To escape each element of a sequence, use the :tfilter:`escapeseq` filter.\n+\n .. templatefilter:: escapejs\n \n ``escapejs``\n@@ -1849,6 +1851,23 @@ For example:\n If ``value`` is ``\"testing\\r\\njavascript 'string\\\" <b>escaping</b>\"``,\n the output will be ``\"testing\\\\u000D\\\\u000Ajavascript \\\\u0027string\\\\u0022 \\\\u003Cb\\\\u003Eescaping\\\\u003C/b\\\\u003E\"``.\n \n+.. templatefilter:: escapeseq\n+\n+``escapeseq``\n+-------------\n+\n+.. versionadded:: 5.0\n+\n+Applies the :tfilter:`escape` filter to each element of a sequence. Useful in\n+conjunction with other filters that operate on sequences, such as\n+:tfilter:`join`. For example:\n+\n+.. code-block:: html+django\n+\n+    {% autoescape off %}\n+        {{ my_list|escapeseq|join:\", \" }}\n+    {% endautoescape %}\n+\n .. templatefilter:: filesizeformat\n \n ``filesizeformat``\ndiff --git a/docs/releases/5.0.txt b/docs/releases/5.0.txt\nindex 611a7bd68b71..e6526dd798f0 100644\n--- a/docs/releases/5.0.txt\n+++ b/docs/releases/5.0.txt\n@@ -345,7 +345,8 @@ Signals\n Templates\n ~~~~~~~~~\n \n-* ...\n+* The new :tfilter:`escapeseq` template filter applies :tfilter:`escape` to\n+  each element of a sequence.\n \n Tests\n ~~~~~\ndiff --git a/tests/template_tests/filter_tests/test_escapeseq.py b/tests/template_tests/filter_tests/test_escapeseq.py\nnew file mode 100644\nindex 000000000000..27092f5828bb\n--- /dev/null\n+++ b/tests/template_tests/filter_tests/test_escapeseq.py\n@@ -0,0 +1,59 @@\n+from django.test import SimpleTestCase\n+from django.utils.safestring import mark_safe\n+\n+from ..utils import setup\n+\n+\n+class EscapeseqTests(SimpleTestCase):\n+    \"\"\"\n+    The \"escapeseq\" filter works the same whether autoescape is on or off,\n+    and has no effect on strings already marked as safe.\n+    \"\"\"\n+\n+    @setup(\n+        {\n+            \"escapeseq_basic\": (\n+                '{{ a|escapeseq|join:\", \" }} -- {{ b|escapeseq|join:\", \" }}'\n+            ),\n+        }\n+    )\n+    def test_basic(self):\n+        output = self.engine.render_to_string(\n+            \"escapeseq_basic\",\n+            {\"a\": [\"x&y\", \"<p>\"], \"b\": [mark_safe(\"x&y\"), mark_safe(\"<p>\")]},\n+        )\n+        self.assertEqual(output, \"x&amp;y, &lt;p&gt; -- x&y, <p>\")\n+\n+    @setup(\n+        {\n+            \"escapeseq_autoescape_off\": (\n+                '{% autoescape off %}{{ a|escapeseq|join:\", \" }}'\n+                \" -- \"\n+                '{{ b|escapeseq|join:\", \"}}{% endautoescape %}'\n+            )\n+        }\n+    )\n+    def test_autoescape_off(self):\n+        output = self.engine.render_to_string(\n+            \"escapeseq_autoescape_off\",\n+            {\"a\": [\"x&y\", \"<p>\"], \"b\": [mark_safe(\"x&y\"), mark_safe(\"<p>\")]},\n+        )\n+        self.assertEqual(output, \"x&amp;y, &lt;p&gt; -- x&y, <p>\")\n+\n+    @setup({\"escapeseq_join\": '{{ a|escapeseq|join:\"<br/>\" }}'})\n+    def test_chain_join(self):\n+        output = self.engine.render_to_string(\"escapeseq_join\", {\"a\": [\"x&y\", \"<p>\"]})\n+        self.assertEqual(output, \"x&amp;y<br/>&lt;p&gt;\")\n+\n+    @setup(\n+        {\n+            \"escapeseq_join_autoescape_off\": (\n+                '{% autoescape off %}{{ a|escapeseq|join:\"<br/>\" }}{% endautoescape %}'\n+            ),\n+        }\n+    )\n+    def test_chain_join_autoescape_off(self):\n+        output = self.engine.render_to_string(\n+            \"escapeseq_join_autoescape_off\", {\"a\": [\"x&y\", \"<p>\"]}\n+        )\n+        self.assertEqual(output, \"x&amp;y<br/>&lt;p&gt;\")\n", "gold_standard_pr_link": "https://github.com/django/django/pull/16877"}