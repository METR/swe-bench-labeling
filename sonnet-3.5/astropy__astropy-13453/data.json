{"instance_id": "astropy__astropy-13453", "score": "I", "diff": "diff --git a/astropy/io/ascii/html.py b/astropy/io/ascii/html.py\nindex 266cf229cc..91901dbf0f 100644\n--- a/astropy/io/ascii/html.py\n+++ b/astropy/io/ascii/html.py\n@@ -168,6 +168,13 @@ class HTMLOutputter(core.TableOutputter):\n                 new_cols.append(col)\n                 col_num += 1\n \n+        # Apply formats if provided\n+        formats = meta.get('formats', {})\n+        for col in new_cols:\n+            if col.name in formats:\n+                format_func = formats[col.name]\n+                col.str_vals = [format_func(val) for val in col.data]\n+\n         return super().__call__(new_cols, meta)\n \n \n@@ -366,6 +373,13 @@ class HTML(core.BaseReader):\n         # Kwargs that get passed on to bleach.clean() if that is available.\n         raw_html_clean_kwargs = self.html.get('raw_html_clean_kwargs', {})\n \n+        # Pass the formats to the HTMLOutputter\n+        self.outputter = HTMLOutputter()\n+        meta = {'formats': self.html.get('formats', {})}\n+\n+        # Use super().write() to generate the HTML output\n+        html_output = super().write(table, outputter=self.outputter, meta=meta)\n+\n         # Use XMLWriter to output HTML to lines\n         w = writer.XMLWriter(ListWriter(lines))\n \ndiff --git a/pyproject.toml b/pyproject.toml\nindex 7a3b85fc92..83f08ed124 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,5 +1,5 @@\n [build-system]\n-requires = [\"setuptools\",\n+requires = [\"setuptools==68.0.0\",\n             \"setuptools_scm>=6.2\",\n             \"wheel\",\n             \"cython==0.29.30\",\n", "gold_standard_diff": "diff --git a/astropy/io/ascii/html.py b/astropy/io/ascii/html.py\nindex 266cf229cc2c..c5a110514588 100644\n--- a/astropy/io/ascii/html.py\n+++ b/astropy/io/ascii/html.py\n@@ -349,11 +349,13 @@ def write(self, table):\n         cols = list(table.columns.values())\n \n         self.data.header.cols = cols\n+        self.data.cols = cols\n \n         if isinstance(self.data.fill_values, tuple):\n             self.data.fill_values = [self.data.fill_values]\n \n         self.data._set_fill_values(cols)\n+        self.data._set_col_formats()\n \n         lines = []\n \ndiff --git a/astropy/io/ascii/tests/test_html.py b/astropy/io/ascii/tests/test_html.py\nindex 0515efa06dac..dcfd2229bd48 100644\n--- a/astropy/io/ascii/tests/test_html.py\n+++ b/astropy/io/ascii/tests/test_html.py\n@@ -717,6 +717,49 @@ def test_multi_column_write_table_html_fill_values_masked():\n     assert buffer_output.getvalue() == buffer_expected.getvalue()\n \n \n+def test_write_table_formatted_columns():\n+    \"\"\"\n+    Test to make sure that the HTML writer writes out using the\n+    supplied formatting.\n+    \"\"\"\n+\n+    col1 = [1, 2]\n+    col2 = [1.234567e-11, -9.876543e11]\n+    formats = {\"C1\": \"04d\", \"C2\": \".2e\"}\n+    table = Table([col1, col2], names=formats.keys())\n+\n+    expected = \"\"\"\\\n+<html>\n+ <head>\n+  <meta charset=\"utf-8\"/>\n+  <meta content=\"text/html;charset=UTF-8\" http-equiv=\"Content-type\"/>\n+ </head>\n+ <body>\n+  <table>\n+   <thead>\n+    <tr>\n+     <th>C1</th>\n+     <th>C2</th>\n+    </tr>\n+   </thead>\n+   <tr>\n+    <td>0001</td>\n+    <td>1.23e-11</td>\n+   </tr>\n+   <tr>\n+    <td>0002</td>\n+    <td>-9.88e+11</td>\n+   </tr>\n+  </table>\n+ </body>\n+</html>\n+    \"\"\"\n+    with StringIO() as sp:\n+        table.write(sp, format=\"html\", formats=formats)\n+        out = sp.getvalue().strip()\n+    assert out == expected.strip()\n+\n+\n @pytest.mark.skipif('not HAS_BS4')\n def test_read_html_unicode():\n     \"\"\"\ndiff --git a/docs/changes/io.ascii/13453.bugfix.rst b/docs/changes/io.ascii/13453.bugfix.rst\nnew file mode 100644\nindex 000000000000..658c4ed07e76\n--- /dev/null\n+++ b/docs/changes/io.ascii/13453.bugfix.rst\n@@ -0,0 +1,3 @@\n+When writing out a :class:`~astropy.table.Table` to HTML format, the\n+``formats`` keyword argument to the :meth:`~astropy.table.Table.write` method\n+will now be applied.\n", "gold_standard_pr_link": "https://github.com/astropy/astropy/pull/13453"}