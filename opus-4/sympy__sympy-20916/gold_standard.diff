From 8a168ffa00bef8f19e80b0867cc06745dd2bb843 Mon Sep 17 00:00:00 2001
From: Constantin Mateescu <costica1234@me.com>
Date: Sat, 6 Feb 2021 07:41:39 +0200
Subject: [PATCH 1/2] Fixed regular expression in conventions.py to match
 Unicode characters.

---
 sympy/printing/conventions.py            | 4 ++--
 sympy/printing/tests/test_conventions.py | 8 ++++++++
 sympy/testing/quality_unicode.py         | 1 +
 3 files changed, 11 insertions(+), 2 deletions(-)

diff --git a/sympy/printing/conventions.py b/sympy/printing/conventions.py
index 9a3be6bbe936..68986693df60 100644
--- a/sympy/printing/conventions.py
+++ b/sympy/printing/conventions.py
@@ -7,7 +7,7 @@
 from collections.abc import Iterable
 from sympy import Derivative
 
-_name_with_digits_p = re.compile(r'^([a-zA-Z]+)([0-9]+)$')
+_name_with_digits_p = re.compile(r'^([^\W\d_]+)([0-9]+)$', re.U)
 
 
 def split_super_sub(text):
@@ -60,7 +60,7 @@ def split_super_sub(text):
         else:
             raise RuntimeError("This should never happen.")
 
-    # make a little exception when a name ends with digits, i.e. treat them
+    # Make a little exception when a name ends with digits, i.e. treat them
     # as a subscript too.
     m = _name_with_digits_p.match(name)
     if m:
diff --git a/sympy/printing/tests/test_conventions.py b/sympy/printing/tests/test_conventions.py
index 87689aa8fce4..a8090556cd6d 100644
--- a/sympy/printing/tests/test_conventions.py
+++ b/sympy/printing/tests/test_conventions.py
@@ -1,3 +1,5 @@
+# -*- coding: utf-8 -*-
+
 from sympy import symbols, Derivative, Integral, exp, cos, oo, Function
 from sympy.functions.special.bessel import besselj
 from sympy.functions.special.polynomials import legendre
@@ -29,6 +31,12 @@ def test_super_sub():
     assert split_super_sub("x__a__b__c__d") == ("x", ["a", "b", "c", "d"], [])
     assert split_super_sub("alpha_11") == ("alpha", [], ["11"])
     assert split_super_sub("alpha_11_11") == ("alpha", [], ["11", "11"])
+    assert split_super_sub("w1") == ("w", [], ["1"])
+    assert split_super_sub("w11") == ("w", [], ["11"])
+    assert split_super_sub("w1^a") == ("w", ["a"], ["1"])
+    assert split_super_sub("Ï‰1") == ("Ï‰", [], ["1"])
+    assert split_super_sub("Ï‰11") == ("Ï‰", [], ["11"])
+    assert split_super_sub("Ï‰1^a") == ("Ï‰", ["a"], ["1"])
     assert split_super_sub("") == ("", [], [])
 
 
diff --git a/sympy/testing/quality_unicode.py b/sympy/testing/quality_unicode.py
index 755837ebb50a..6adf22ad52f4 100644
--- a/sympy/testing/quality_unicode.py
+++ b/sympy/testing/quality_unicode.py
@@ -44,6 +44,7 @@
     r'*/sympy/vector/tests/test_printing.py',
     r'*/sympy/parsing/tests/test_sympy_parser.py',
     r'*/sympy/printing/pretty/tests/test_pretty.py',
+    r'*/sympy/printing/tests/test_conventions.py',
     r'*/sympy/printing/tests/test_preview.py',
     r'*/liealgebras/type_g.py',
     r'*/liealgebras/weyl_group.py',

From cf8a148b80048c0a53af05ae075424b2240339c5 Mon Sep 17 00:00:00 2001
From: Constantin Mateescu <costica1234@me.com>
Date: Sat, 13 Feb 2021 09:54:34 +0200
Subject: [PATCH 2/2] Replaced [0-9] with \d to cover Unicode digits.

---
 sympy/printing/conventions.py            | 2 +-
 sympy/printing/tests/test_conventions.py | 5 +++++
 2 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/sympy/printing/conventions.py b/sympy/printing/conventions.py
index 68986693df60..dbaaaf3f027f 100644
--- a/sympy/printing/conventions.py
+++ b/sympy/printing/conventions.py
@@ -7,7 +7,7 @@
 from collections.abc import Iterable
 from sympy import Derivative
 
-_name_with_digits_p = re.compile(r'^([^\W\d_]+)([0-9]+)$', re.U)
+_name_with_digits_p = re.compile(r'^([^\W\d_]+)(\d+)$', re.U)
 
 
 def split_super_sub(text):
diff --git a/sympy/printing/tests/test_conventions.py b/sympy/printing/tests/test_conventions.py
index a8090556cd6d..7990a04b1e62 100644
--- a/sympy/printing/tests/test_conventions.py
+++ b/sympy/printing/tests/test_conventions.py
@@ -32,11 +32,16 @@ def test_super_sub():
     assert split_super_sub("alpha_11") == ("alpha", [], ["11"])
     assert split_super_sub("alpha_11_11") == ("alpha", [], ["11", "11"])
     assert split_super_sub("w1") == ("w", [], ["1"])
+    assert split_super_sub("wğŸ™") == ("w", [], ["ğŸ™"])
     assert split_super_sub("w11") == ("w", [], ["11"])
+    assert split_super_sub("wğŸ™ğŸ™") == ("w", [], ["ğŸ™ğŸ™"])
+    assert split_super_sub("wğŸ™2ğŸ™") == ("w", [], ["ğŸ™2ğŸ™"])
     assert split_super_sub("w1^a") == ("w", ["a"], ["1"])
     assert split_super_sub("Ï‰1") == ("Ï‰", [], ["1"])
     assert split_super_sub("Ï‰11") == ("Ï‰", [], ["11"])
     assert split_super_sub("Ï‰1^a") == ("Ï‰", ["a"], ["1"])
+    assert split_super_sub("Ï‰ğŸ™^Î±") == ("Ï‰", ["Î±"], ["ğŸ™"])
+    assert split_super_sub("Ï‰ğŸ™2^3Î±") == ("Ï‰", ["3Î±"], ["ğŸ™2"])
     assert split_super_sub("") == ("", [], [])
 
 
