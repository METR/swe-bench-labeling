{"instance_id": "pytest-dev__pytest-5262", "score": "I", "diff": "diff --git a/src/_pytest/capture.py b/src/_pytest/capture.py\nindex 25eab7fdf..c9e8adb50 100644\n--- a/src/_pytest/capture.py\n+++ b/src/_pytest/capture.py\n@@ -432,9 +432,9 @@ class EncodedFile(object):\n     def write(self, obj):\n         if isinstance(obj, six.text_type):\n             obj = obj.encode(self.encoding, \"replace\")\n-        elif _PY3:\n+        elif not isinstance(obj, bytes):\n             raise TypeError(\n-                \"write() argument must be str, not {}\".format(type(obj).__name__)\n+                \"write() argument must be str or bytes, not {}\".format(type(obj).__name__)\n             )\n         self.buffer.write(obj)\n \n@@ -450,6 +450,11 @@ class EncodedFile(object):\n     def __getattr__(self, name):\n         return getattr(object.__getattribute__(self, \"buffer\"), name)\n \n+    @property\n+    def mode(self):\n+        \"\"\"Remove 'b' from the mode to avoid issues with libraries like youtube-dl.\"\"\"\n+        return self.buffer.mode.replace('b', '')\n+\n \n CaptureResult = collections.namedtuple(\"CaptureResult\", [\"out\", \"err\"])\n \n", "gold_standard_diff": "From 4318698baeab38a413d8c3684248f95a2fed3979 Mon Sep 17 00:00:00 2001\nFrom: Anthony Sottile <asottile@umich.edu>\nDate: Tue, 14 May 2019 14:54:03 -0700\nSubject: [PATCH] Remove 'b' from sys.stdout.mode\n\n---\n changelog/5257.bugfix.rst | 1 +\n src/_pytest/capture.py    | 4 ++++\n testing/test_capture.py   | 3 +++\n 3 files changed, 8 insertions(+)\n create mode 100644 changelog/5257.bugfix.rst\n\ndiff --git a/changelog/5257.bugfix.rst b/changelog/5257.bugfix.rst\nnew file mode 100644\nindex 00000000000..5205190882d\n--- /dev/null\n+++ b/changelog/5257.bugfix.rst\n@@ -0,0 +1 @@\n+Ensure that ``sys.stdout.mode`` does not include ``'b'`` as it is a text stream.\ndiff --git a/src/_pytest/capture.py b/src/_pytest/capture.py\nindex 25eab7fdf14..56017113429 100644\n--- a/src/_pytest/capture.py\n+++ b/src/_pytest/capture.py\n@@ -447,6 +447,10 @@ def name(self):\n         \"\"\"Ensure that file.name is a string.\"\"\"\n         return repr(self.buffer)\n \n+    @property\n+    def mode(self):\n+        return self.buffer.mode.replace(\"b\", \"\")\n+\n     def __getattr__(self, name):\n         return getattr(object.__getattribute__(self, \"buffer\"), name)\n \ndiff --git a/testing/test_capture.py b/testing/test_capture.py\nindex 5d80eb63da0..f1802cc16dc 100644\n--- a/testing/test_capture.py\n+++ b/testing/test_capture.py\n@@ -1051,6 +1051,9 @@ def test_simple_resume_suspend(self, tmpfile):\n             cap.done()\n             pytest.raises(AttributeError, cap.suspend)\n \n+    def test_capfd_sys_stdout_mode(self, capfd):\n+        assert \"b\" not in sys.stdout.mode\n+\n \n @contextlib.contextmanager\n def saved_fd(fd):\n", "gold_standard_pr_link": "https://github.com/pytest-dev/pytest/pull/5262"}