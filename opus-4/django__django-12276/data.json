{"instance_id": "django__django-12276", "score": "C", "diff": "diff --git a/django/forms/widgets.py b/django/forms/widgets.py\nindex 338d54d72f..40ac1d3162 100644\n--- a/django/forms/widgets.py\n+++ b/django/forms/widgets.py\n@@ -387,6 +387,9 @@ class FileInput(Input):\n     def value_omitted_from_data(self, data, files, name):\n         return name not in files\n \n+    def use_required_attribute(self, initial):\n+        return super().use_required_attribute(initial) and not initial\n+\n \n FILE_INPUT_CONTRADICTION = object()\n \n@@ -451,9 +454,6 @@ class ClearableFileInput(FileInput):\n             return False\n         return upload\n \n-    def use_required_attribute(self, initial):\n-        return super().use_required_attribute(initial) and not initial\n-\n     def value_omitted_from_data(self, data, files, name):\n         return (\n             super().value_omitted_from_data(data, files, name) and\ndiff --git a/test_comprehensive_file_input.py b/test_comprehensive_file_input.py\nnew file mode 100644\nindex 0000000000..7b42f58f6b\n--- /dev/null\n+++ b/test_comprehensive_file_input.py\n@@ -0,0 +1,83 @@\n+#!/usr/bin/env python\n+import os\n+import sys\n+\n+# Add Django to the path\n+sys.path.insert(0, '/testbed')\n+os.environ['DJANGO_SETTINGS_MODULE'] = 'django.conf.settings'\n+\n+import django\n+from django.conf import settings\n+\n+# Configure Django settings\n+settings.configure(\n+    DEBUG=True,\n+    SECRET_KEY='test-secret-key',\n+    INSTALLED_APPS=[\n+        'django.contrib.contenttypes',\n+        'django.contrib.auth',\n+    ],\n+    DATABASES={\n+        'default': {\n+            'ENGINE': 'django.db.backends.sqlite3',\n+            'NAME': ':memory:',\n+        }\n+    },\n+    USE_TZ=True,\n+    DEFAULT_FILE_STORAGE='django.core.files.storage.FileSystemStorage',\n+    MEDIA_ROOT='/tmp/media/',\n+    MEDIA_URL='/media/',\n+)\n+django.setup()\n+\n+# Now test the widgets\n+from django import forms\n+from django.forms.widgets import FileInput, ClearableFileInput, HiddenInput\n+from django.core.files.uploadedfile import SimpleUploadedFile\n+\n+# Test with forms to ensure proper rendering\n+class TestForm(forms.Form):\n+    file_field = forms.FileField(required=True, widget=FileInput())\n+    clearable_file_field = forms.FileField(required=True, widget=ClearableFileInput())\n+\n+# Create form without initial data\n+form = TestForm()\n+print(\"Form without initial data:\")\n+print(f\"file_field HTML:\\n{form['file_field']}\")\n+print(f\"\\nclearable_file_field HTML:\\n{form['clearable_file_field']}\")\n+\n+# Create form with initial data\n+initial_file = SimpleUploadedFile(\"test.txt\", b\"file content\")\n+form_with_initial = TestForm(initial={'file_field': initial_file, 'clearable_file_field': initial_file})\n+print(\"\\n\\nForm with initial data:\")\n+print(f\"file_field HTML:\\n{form_with_initial['file_field']}\")\n+print(f\"\\nclearable_file_field HTML:\\n{form_with_initial['clearable_file_field']}\")\n+\n+# Test edge cases\n+print(\"\\n\\nEdge case tests:\")\n+\n+# Test with hidden widget (should always return False)\n+hidden_input = HiddenInput()\n+hidden_input.is_required = True\n+print(f\"HiddenInput.use_required_attribute(None): {hidden_input.use_required_attribute(None)}\")\n+print(f\"HiddenInput.use_required_attribute(initial_file): {hidden_input.use_required_attribute(initial_file)}\")\n+\n+# Test with different types of initial values\n+file_input = FileInput()\n+file_input.is_required = True\n+\n+print(f\"\\nFileInput.use_required_attribute(None): {file_input.use_required_attribute(None)}\")\n+print(f\"FileInput.use_required_attribute(False): {file_input.use_required_attribute(False)}\")\n+print(f\"FileInput.use_required_attribute(''): {file_input.use_required_attribute('')}\")\n+print(f\"FileInput.use_required_attribute('some_string'): {file_input.use_required_attribute('some_string')}\")\n+print(f\"FileInput.use_required_attribute(initial_file): {file_input.use_required_attribute(initial_file)}\")\n+\n+# Test that the behavior is inherited correctly\n+clearable_input = ClearableFileInput()\n+clearable_input.is_required = True\n+\n+print(f\"\\nClearableFileInput.use_required_attribute(None): {clearable_input.use_required_attribute(None)}\")\n+print(f\"ClearableFileInput.use_required_attribute(False): {clearable_input.use_required_attribute(False)}\")\n+print(f\"ClearableFileInput.use_required_attribute(''): {clearable_input.use_required_attribute('')}\")\n+print(f\"ClearableFileInput.use_required_attribute('some_string'): {clearable_input.use_required_attribute('some_string')}\")\n+print(f\"ClearableFileInput.use_required_attribute(initial_file): {clearable_input.use_required_attribute(initial_file)}\")\ndiff --git a/test_file_input_required.py b/test_file_input_required.py\nnew file mode 100644\nindex 0000000000..e149181e01\n--- /dev/null\n+++ b/test_file_input_required.py\n@@ -0,0 +1,54 @@\n+#!/usr/bin/env python\n+import os\n+import sys\n+\n+# Add Django to the path\n+sys.path.insert(0, '/testbed')\n+os.environ['DJANGO_SETTINGS_MODULE'] = 'django.conf.settings'\n+\n+import django\n+from django.conf import settings\n+\n+# Configure Django settings\n+settings.configure(\n+    DEBUG=True,\n+    SECRET_KEY='test-secret-key',\n+    INSTALLED_APPS=[\n+        'django.contrib.contenttypes',\n+        'django.contrib.auth',\n+    ],\n+    DATABASES={\n+        'default': {\n+            'ENGINE': 'django.db.backends.sqlite3',\n+            'NAME': ':memory:',\n+        }\n+    },\n+    USE_TZ=True,\n+)\n+django.setup()\n+\n+# Now test the widgets\n+from django.forms.widgets import FileInput, ClearableFileInput\n+from django.core.files.uploadedfile import SimpleUploadedFile\n+\n+# Test FileInput widget\n+print(\"Testing FileInput widget:\")\n+file_input = FileInput()\n+file_input.is_required = True\n+\n+# Test without initial data\n+print(f\"FileInput.use_required_attribute(None): {file_input.use_required_attribute(None)}\")\n+\n+# Test with initial data (simulating an already uploaded file)\n+initial_file = SimpleUploadedFile(\"test.txt\", b\"file content\")\n+print(f\"FileInput.use_required_attribute(initial_file): {file_input.use_required_attribute(initial_file)}\")\n+\n+print(\"\\nTesting ClearableFileInput widget:\")\n+clearable_file_input = ClearableFileInput()\n+clearable_file_input.is_required = True\n+\n+# Test without initial data\n+print(f\"ClearableFileInput.use_required_attribute(None): {clearable_file_input.use_required_attribute(None)}\")\n+\n+# Test with initial data\n+print(f\"ClearableFileInput.use_required_attribute(initial_file): {clearable_file_input.use_required_attribute(initial_file)}\")\ndiff --git a/test_html_output.py b/test_html_output.py\nnew file mode 100644\nindex 0000000000..238262c559\n--- /dev/null\n+++ b/test_html_output.py\n@@ -0,0 +1,65 @@\n+#!/usr/bin/env python\n+import os\n+import sys\n+\n+# Add Django to the path\n+sys.path.insert(0, '/testbed')\n+os.environ['DJANGO_SETTINGS_MODULE'] = 'django.conf.settings'\n+\n+import django\n+from django.conf import settings\n+\n+# Configure Django settings\n+settings.configure(\n+    DEBUG=True,\n+    SECRET_KEY='test-secret-key',\n+    INSTALLED_APPS=[],\n+    DATABASES={\n+        'default': {\n+            'ENGINE': 'django.db.backends.sqlite3',\n+            'NAME': ':memory:',\n+        }\n+    },\n+)\n+django.setup()\n+\n+# Now test the widgets behavior\n+from django.forms.widgets import FileInput, ClearableFileInput\n+from django.forms import Form, FileField\n+\n+# Test with forms\n+class TestForm(Form):\n+    file_field = FileField(required=True, widget=FileInput())\n+    clearable_field = FileField(required=True, widget=ClearableFileInput())\n+\n+print(\"=== FileInput Tests ===\")\n+\n+# Without initial data\n+form = TestForm()\n+print(\"Required FileInput without initial:\")\n+print(form['file_field'])\n+\n+# With initial data  \n+class MockFile:\n+    def __init__(self, name):\n+        self.name = name\n+        self.url = f'/media/{name}'\n+    \n+    def __str__(self):\n+        return self.name\n+\n+form = TestForm(initial={'file_field': MockFile('existing.pdf'), 'clearable_field': MockFile('existing.pdf')})\n+print(\"\\nRequired FileInput WITH initial:\")\n+print(form['file_field'])\n+\n+print(\"\\n=== ClearableFileInput Tests ===\")\n+\n+# Without initial data\n+form = TestForm()\n+print(\"Required ClearableFileInput without initial:\")\n+print(form['clearable_field'])\n+\n+# With initial data\n+form_with_initial = TestForm(initial={'file_field': MockFile('existing.pdf'), 'clearable_field': MockFile('existing.pdf')})\n+print(\"\\nRequired ClearableFileInput WITH initial:\")\n+print(form_with_initial['clearable_field'])\ndiff --git a/tests/forms_tests/widget_tests/test_fileinput.py b/tests/forms_tests/widget_tests/test_fileinput.py\nindex bbd7c7fe52..7d232ee211 100644\n--- a/tests/forms_tests/widget_tests/test_fileinput.py\n+++ b/tests/forms_tests/widget_tests/test_fileinput.py\n@@ -18,3 +18,10 @@ class FileInputTest(WidgetTest):\n     def test_value_omitted_from_data(self):\n         self.assertIs(self.widget.value_omitted_from_data({}, {}, 'field'), True)\n         self.assertIs(self.widget.value_omitted_from_data({}, {'field': 'value'}, 'field'), False)\n+\n+    def test_use_required_attribute(self):\n+        # Without initial data, required attribute should be used\n+        self.assertIs(self.widget.use_required_attribute(None), True)\n+        self.assertIs(self.widget.use_required_attribute(''), True)\n+        # With initial data (like an already uploaded file), required attribute should not be used\n+        self.assertIs(self.widget.use_required_attribute('file.txt'), False)\n", "gold_standard_diff": "diff --git a/django/forms/widgets.py b/django/forms/widgets.py\nindex 338d54d72f16..40ac1d316242 100644\n--- a/django/forms/widgets.py\n+++ b/django/forms/widgets.py\n@@ -387,6 +387,9 @@ def value_from_datadict(self, data, files, name):\n     def value_omitted_from_data(self, data, files, name):\n         return name not in files\n \n+    def use_required_attribute(self, initial):\n+        return super().use_required_attribute(initial) and not initial\n+\n \n FILE_INPUT_CONTRADICTION = object()\n \n@@ -451,9 +454,6 @@ def value_from_datadict(self, data, files, name):\n             return False\n         return upload\n \n-    def use_required_attribute(self, initial):\n-        return super().use_required_attribute(initial) and not initial\n-\n     def value_omitted_from_data(self, data, files, name):\n         return (\n             super().value_omitted_from_data(data, files, name) and\ndiff --git a/docs/ref/forms/widgets.txt b/docs/ref/forms/widgets.txt\nindex a9c442289c72..e98615475353 100644\n--- a/docs/ref/forms/widgets.txt\n+++ b/docs/ref/forms/widgets.txt\n@@ -325,17 +325,22 @@ foundation for custom widgets.\n         to display the ``required`` attribute for each field.\n \n         By default, returns ``False`` for hidden widgets and ``True``\n-        otherwise. Special cases are :class:`~django.forms.ClearableFileInput`,\n-        which returns ``False`` when ``initial`` is set, and\n-        :class:`~django.forms.CheckboxSelectMultiple`, which always returns\n-        ``False`` because browser validation would require all checkboxes to be\n-        checked instead of at least one.\n+        otherwise. Special cases are :class:`~django.forms.FileInput` and\n+        :class:`~django.forms.ClearableFileInput`, which return ``False`` when\n+        ``initial`` is set, and :class:`~django.forms.CheckboxSelectMultiple`,\n+        which always returns ``False`` because browser validation would require\n+        all checkboxes to be checked instead of at least one.\n \n         Override this method in custom widgets that aren't compatible with\n         browser validation. For example, a WSYSIWG text editor widget backed by\n         a hidden ``textarea`` element may want to always return ``False`` to\n         avoid browser validation on the hidden field.\n \n+        .. versionchanged:: 3.1\n+\n+            In older versions, ``True`` was returned for\n+            :class:`~django.forms.FileInput` when ``initial`` was set.\n+\n ``MultiWidget``\n ---------------\n \ndiff --git a/docs/releases/3.1.txt b/docs/releases/3.1.txt\nindex ffffdc0d1b0d..cdacbd71cda9 100644\n--- a/docs/releases/3.1.txt\n+++ b/docs/releases/3.1.txt\n@@ -406,6 +406,9 @@ Miscellaneous\n * Date-only formats are removed from the default list for\n   :setting:`DATETIME_INPUT_FORMATS`.\n \n+* The :class:`~django.forms.FileInput` widget no longer renders with the\n+  ``required`` HTML attribute when initial data exists.\n+\n .. _deprecated-features-3.1:\n \n Features deprecated in 3.1\ndiff --git a/tests/forms_tests/tests/test_forms.py b/tests/forms_tests/tests/test_forms.py\nindex 552f3b866caa..e4a8127e1543 100644\n--- a/tests/forms_tests/tests/test_forms.py\n+++ b/tests/forms_tests/tests/test_forms.py\n@@ -8,11 +8,11 @@\n from django.core.validators import MaxValueValidator, RegexValidator\n from django.forms import (\n     BooleanField, CharField, CheckboxSelectMultiple, ChoiceField, DateField,\n-    DateTimeField, EmailField, FileField, FloatField, Form, HiddenInput,\n-    ImageField, IntegerField, MultipleChoiceField, MultipleHiddenInput,\n-    MultiValueField, NullBooleanField, PasswordInput, RadioSelect, Select,\n-    SplitDateTimeField, SplitHiddenDateTimeWidget, Textarea, TextInput,\n-    TimeField, ValidationError, forms,\n+    DateTimeField, EmailField, FileField, FileInput, FloatField, Form,\n+    HiddenInput, ImageField, IntegerField, MultipleChoiceField,\n+    MultipleHiddenInput, MultiValueField, NullBooleanField, PasswordInput,\n+    RadioSelect, Select, SplitDateTimeField, SplitHiddenDateTimeWidget,\n+    Textarea, TextInput, TimeField, ValidationError, forms,\n )\n from django.forms.renderers import DjangoTemplates, get_default_renderer\n from django.forms.utils import ErrorList\n@@ -2486,6 +2486,25 @@ class FileForm(forms.Form):\n         self.assertEqual(f.errors, {})\n         self.assertEqual(f.cleaned_data['file1'], 'resume.txt')\n \n+    def test_filefield_with_fileinput_required(self):\n+        class FileForm(Form):\n+            file1 = forms.FileField(widget=FileInput)\n+\n+        f = FileForm(auto_id=False)\n+        self.assertHTMLEqual(\n+            f.as_table(),\n+            '<tr><th>File1:</th><td>'\n+            '<input type=\"file\" name=\"file1\" required></td></tr>',\n+        )\n+        # A required file field with initial data doesn't contain the required\n+        # HTML attribute. The file input is left blank by the user to keep the\n+        # existing, initial value.\n+        f = FileForm(initial={'file1': 'resume.txt'}, auto_id=False)\n+        self.assertHTMLEqual(\n+            f.as_table(),\n+            '<tr><th>File1:</th><td><input type=\"file\" name=\"file1\"></td></tr>',\n+        )\n+\n     def test_basic_processing_in_view(self):\n         class UserRegistration(Form):\n             username = CharField(max_length=10)\ndiff --git a/tests/forms_tests/widget_tests/test_fileinput.py b/tests/forms_tests/widget_tests/test_fileinput.py\nindex bbd7c7fe527c..8eec26253af4 100644\n--- a/tests/forms_tests/widget_tests/test_fileinput.py\n+++ b/tests/forms_tests/widget_tests/test_fileinput.py\n@@ -18,3 +18,9 @@ def test_render(self):\n     def test_value_omitted_from_data(self):\n         self.assertIs(self.widget.value_omitted_from_data({}, {}, 'field'), True)\n         self.assertIs(self.widget.value_omitted_from_data({}, {'field': 'value'}, 'field'), False)\n+\n+    def test_use_required_attribute(self):\n+        # False when initial data exists. The file input is left blank by the\n+        # user to keep the existing, initial value.\n+        self.assertIs(self.widget.use_required_attribute(None), True)\n+        self.assertIs(self.widget.use_required_attribute('resume.txt'), False)\n", "gold_standard_pr_link": "https://github.com/django/django/pull/12276"}