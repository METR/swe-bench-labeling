{"instance_id": "matplotlib__matplotlib-23476", "score": "I", "diff": "diff --git a/lib/matplotlib/figure.py b/lib/matplotlib/figure.py\nindex c55864243a..94d8da90b1 100644\n--- a/lib/matplotlib/figure.py\n+++ b/lib/matplotlib/figure.py\n@@ -3052,7 +3052,9 @@ class Figure(FigureBase):\n             import matplotlib._pylab_helpers as pylab_helpers\n             allnums = plt.get_fignums()\n             num = max(allnums) + 1 if allnums else 1\n+            original_dpi = self.dpi\n             mgr = plt._backend_mod.new_figure_manager_given_figure(num, self)\n+            self.dpi = original_dpi  # Restore the original DPI\n             pylab_helpers.Gcf._set_new_active_manager(mgr)\n             plt.draw_if_interactive()\n \n", "gold_standard_diff": "diff --git a/lib/matplotlib/figure.py b/lib/matplotlib/figure.py\nindex c55864243a75..6516816ed6f6 100644\n--- a/lib/matplotlib/figure.py\n+++ b/lib/matplotlib/figure.py\n@@ -3023,6 +3023,9 @@ def __getstate__(self):\n         # Set cached renderer to None -- it can't be pickled.\n         state[\"_cachedRenderer\"] = None\n \n+        # discard any changes to the dpi due to pixel ratio changes\n+        state[\"_dpi\"] = state.get('_original_dpi', state['_dpi'])\n+\n         # add version information to the state\n         state['__mpl_version__'] = mpl.__version__\n \ndiff --git a/lib/matplotlib/tests/test_figure.py b/lib/matplotlib/tests/test_figure.py\nindex ec1a814ebc59..9f3eb68281ca 100644\n--- a/lib/matplotlib/tests/test_figure.py\n+++ b/lib/matplotlib/tests/test_figure.py\n@@ -2,6 +2,7 @@\n from datetime import datetime\n import io\n from pathlib import Path\n+import pickle\n import platform\n from threading import Timer\n from types import SimpleNamespace\n@@ -1380,3 +1381,11 @@ def test_deepcopy():\n \n     assert ax.get_xlim() == (1e-1, 1e2)\n     assert fig2.axes[0].get_xlim() == (0, 1)\n+\n+\n+def test_unpickle_with_device_pixel_ratio():\n+    fig = Figure(dpi=42)\n+    fig.canvas._set_device_pixel_ratio(7)\n+    assert fig.dpi == 42*7\n+    fig2 = pickle.loads(pickle.dumps(fig))\n+    assert fig2.dpi == 42\n", "gold_standard_pr_link": "https://github.com/matplotlib/matplotlib/pull/23476"}