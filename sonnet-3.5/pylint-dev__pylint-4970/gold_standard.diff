From c81eecff6ff1f515f8d645bae52d63022c4da884 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Dani=C3=ABl=20van=20Noord?=
 <13665637+DanielNoord@users.noreply.github.com>
Date: Sun, 5 Sep 2021 21:43:24 +0200
Subject: [PATCH 1/3] Make ``min-similarity-lines == 0`` stop similarity check
 This makes it so that setting ``min-similarity-lines`` to zero exit the
 similarity code checker with a successful exit. This closes #4901

---
 ChangeLog                          | 4 ++++
 doc/whatsnew/2.11.rst              | 4 ++++
 pylint/checkers/similar.py         | 2 ++
 tests/checkers/unittest_similar.py | 8 ++++++++
 4 files changed, 18 insertions(+)

diff --git a/ChangeLog b/ChangeLog
index ee1b82af53..818e08af1a 100644
--- a/ChangeLog
+++ b/ChangeLog
@@ -63,6 +63,10 @@ Release date: TBA
 
   Closes #4907
 
+* Setting ``min-similarity-lines`` to 0 now makes the similarty checker stop checking for duplicate code
+
+  Closes #4901
+
 
 What's New in Pylint 2.10.3?
 ============================
diff --git a/doc/whatsnew/2.11.rst b/doc/whatsnew/2.11.rst
index cdbba865d4..ac98463027 100644
--- a/doc/whatsnew/2.11.rst
+++ b/doc/whatsnew/2.11.rst
@@ -69,3 +69,7 @@ Other Changes
 * Fix false positive ``superfluous-parens`` for tuples created with inner tuples
 
   Closes #4907
+
+* Setting ``min-similarity-lines`` to 0 now makes the similarty checker stop checking for duplicate code
+
+  Closes #4901
diff --git a/pylint/checkers/similar.py b/pylint/checkers/similar.py
index c65b1c8933..cb002c3db5 100644
--- a/pylint/checkers/similar.py
+++ b/pylint/checkers/similar.py
@@ -919,6 +919,8 @@ def Run(argv=None):
             ignore_signatures = True
     if not args:
         usage(1)
+    if min_lines == 0:
+        sys.exit(0)
     sim = Similar(
         min_lines, ignore_comments, ignore_docstrings, ignore_imports, ignore_signatures
     )
diff --git a/tests/checkers/unittest_similar.py b/tests/checkers/unittest_similar.py
index 4ddf2029a2..c98ea15df5 100644
--- a/tests/checkers/unittest_similar.py
+++ b/tests/checkers/unittest_similar.py
@@ -502,3 +502,11 @@ def test_get_map_data() -> None:
         # There doesn't seem to be a faster way of doing this, yet.
         lines = (linespec.text for linespec in lineset_obj.stripped_lines)
         assert tuple(expected_lines) == tuple(lines)
+
+
+def test_set_duplicate_lines_to_zero() -> None:
+    output = StringIO()
+    with redirect_stdout(output), pytest.raises(SystemExit) as ex:
+        similar.Run(["--duplicates=0", SIMILAR1, SIMILAR2])
+    assert ex.value.code == 0
+    assert output.getvalue() == ""

From 695809cee4ba6ea166446d9daa47a953f3b5dc03 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Dani=C3=ABl=20van=20Noord?=
 <13665637+DanielNoord@users.noreply.github.com>
Date: Mon, 6 Sep 2021 00:16:30 +0200
Subject: [PATCH 2/3] Move check to `run()`

---
 pylint/checkers/similar.py | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/pylint/checkers/similar.py b/pylint/checkers/similar.py
index cb002c3db5..20419a67cd 100644
--- a/pylint/checkers/similar.py
+++ b/pylint/checkers/similar.py
@@ -390,6 +390,8 @@ def append_stream(self, streamid: str, stream: TextIO, encoding=None) -> None:
 
     def run(self) -> None:
         """start looking for similarities and display results on stdout"""
+        if self.min_lines == 0:
+            sys.exit(0)
         self._display_sims(self._compute_sims())
 
     def _compute_sims(self) -> List[Tuple[int, Set[LinesChunkLimits_T]]]:
@@ -919,8 +921,6 @@ def Run(argv=None):
             ignore_signatures = True
     if not args:
         usage(1)
-    if min_lines == 0:
-        sys.exit(0)
     sim = Similar(
         min_lines, ignore_comments, ignore_docstrings, ignore_imports, ignore_signatures
     )

From 595556861fe8813de1c3162133fef7135b7cca79 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Dani=C3=ABl=20van=20Noord?=
 <13665637+DanielNoord@users.noreply.github.com>
Date: Mon, 6 Sep 2021 00:20:11 +0200
Subject: [PATCH 3/3] Update similar.py

---
 pylint/checkers/similar.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/pylint/checkers/similar.py b/pylint/checkers/similar.py
index 20419a67cd..88d7eac525 100644
--- a/pylint/checkers/similar.py
+++ b/pylint/checkers/similar.py
@@ -391,7 +391,7 @@ def append_stream(self, streamid: str, stream: TextIO, encoding=None) -> None:
     def run(self) -> None:
         """start looking for similarities and display results on stdout"""
         if self.min_lines == 0:
-            sys.exit(0)
+            return
         self._display_sims(self._compute_sims())
 
     def _compute_sims(self) -> List[Tuple[int, Set[LinesChunkLimits_T]]]:
